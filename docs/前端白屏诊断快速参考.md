# å‰ç«¯ç™½å±è¯Šæ–­å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### WSL2 ç¯å¢ƒè¯Šæ–­ï¼ˆæ¨èï¼‰

```bash
# åœ¨ WSL2 ä¸­è¿è¡Œ
cd ~/projects/Pyt
bash /mnt/c/Users/zhou/Code/Pyt/scripts/diagnose_frontend_whitescreen.sh ~/projects/Pyt
```

### macOS ç¯å¢ƒéªŒè¯

```bash
# åœ¨ macOS ä¸­è¿è¡Œï¼ˆé€šè¿‡ WSL è®¿é—®ï¼‰
cd /Users/zhou/Code/Pyt
bash scripts/verify_deployment_macos.sh ~/projects/Pyt
```

---

## ğŸ“‹ è¯Šæ–­è„šæœ¬åŠŸèƒ½å¯¹æ¯”

| è„šæœ¬ | è¿è¡Œç¯å¢ƒ | ä¸»è¦åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|---------|---------|---------|
| `diagnose_frontend_whitescreen.sh` | WSL2 | å®Œæ•´è¯Šæ–­ï¼ˆå®¹å™¨ã€æ–‡ä»¶ã€é…ç½®ã€æ—¥å¿—ï¼‰ | åœ¨ WSL2 ä¸­è¯¦ç»†æ’æŸ¥é—®é¢˜ |
| `verify_deployment_macos.sh` | macOS | è¿œç¨‹éªŒè¯ï¼ˆé€šè¿‡ WSL è®¿é—®ï¼‰ | ä» macOS éªŒè¯ WSL2 éƒ¨ç½² |
| `verify_deployment_remote.sh` | macOS/Linux | SSH è¿œç¨‹éªŒè¯ | é€šè¿‡ SSH éªŒè¯è¿œç¨‹æœåŠ¡å™¨ |

---

## ğŸ” è¯Šæ–­æ£€æŸ¥é¡¹

### 1. å®¹å™¨çŠ¶æ€æ£€æŸ¥
- âœ… frontend-init: `Exited (0)` - å¿…é¡»æˆåŠŸå®Œæˆ
- âœ… nginx: `Up (healthy)` - å¿…é¡»è¿è¡Œä¸”å¥åº·
- âœ… api: `Up (healthy)` - å¿…é¡»è¿è¡Œä¸”å¥åº·
- âœ… database: `Up (healthy)` - å¿…é¡»è¿è¡Œä¸”å¥åº·
- âœ… redis: `Up (healthy)` - å¿…é¡»è¿è¡Œä¸”å¥åº·

### 2. é™æ€æ–‡ä»¶æ£€æŸ¥
- âœ… `frontend/dist/index.html` å­˜åœ¨ä¸”å¤§å° > 1KB
- âœ… `frontend/dist/assets/` ç›®å½•å­˜åœ¨
- âœ… è‡³å°‘æœ‰å‡ ä¸ª `.js` å’Œ `.css` æ–‡ä»¶
- âœ… æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆå¯è¯»ï¼‰

### 3. Nginx é…ç½®æ£€æŸ¥
- âœ… ä½¿ç”¨ Scheme B é…ç½®ï¼ˆ`root /usr/share/nginx/html`ï¼‰
- âœ… ä¸åŒ…å« Scheme A æ®‹ç•™ï¼ˆ`frontend_backend`ï¼‰
- âœ… é…ç½®è¯­æ³•æ­£ç¡®

### 4. HTTP ç«¯ç‚¹æ£€æŸ¥
- âœ… `http://localhost/` è¿”å› 200
- âœ… `http://localhost/api/v1/monitoring/health` è¿”å› 200
- âœ… `http://localhost/health` è¿”å› 200

### 5. HTML å†…å®¹æ£€æŸ¥
- âœ… HTML åŒ…å« `<!DOCTYPE html>`
- âœ… åŒ…å«è„šæœ¬æ ‡ç­¾ï¼ˆ`<script>`ï¼‰
- âœ… åŒ…å« Vue åº”ç”¨æŒ‚è½½ç‚¹ï¼ˆ`id="app"`ï¼‰

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜å¿«é€Ÿä¿®å¤

### é—®é¢˜ 1: frontend-init å¤±è´¥

```bash
# æŸ¥çœ‹æ—¥å¿—
docker logs pepgmp-frontend-init

# æ£€æŸ¥é•œåƒæ ‡ç­¾
grep IMAGE_TAG .env.production
docker images | grep pepgmp-frontend

# é‡æ–°è¿è¡Œ
docker compose -f docker-compose.prod.yml up -d frontend-init
sleep 15
docker logs pepgmp-frontend-init
```

### é—®é¢˜ 2: é™æ€æ–‡ä»¶ä¸å­˜åœ¨

```bash
# æ¸…ç†å¹¶é‡æ–°æå–
rm -rf frontend/dist/*
docker compose -f docker-compose.prod.yml up -d frontend-init
sleep 15
ls -la frontend/dist/
```

### é—®é¢˜ 3: Nginx é…ç½®é”™è¯¯

```bash
# é‡æ–°å¤åˆ¶é…ç½®æ–‡ä»¶
cp /mnt/c/Users/zhou/Code/Pyt/nginx/nginx.conf nginx/nginx.conf

# éªŒè¯å¹¶é‡å¯
docker exec pepgmp-nginx-prod nginx -t
docker compose -f docker-compose.prod.yml restart nginx
```

### é—®é¢˜ 4: æµè§ˆå™¨ç¼“å­˜

**Chrome/Edge**:
- æŒ‰ `Ctrl + Shift + Delete` â†’ æ¸…é™¤ç¼“å­˜
- æˆ–ä½¿ç”¨éšèº«æ¨¡å¼ï¼ˆ`Ctrl + Shift + N`ï¼‰

**å¼€å‘è€…å·¥å…·**:
- æŒ‰ `F12` â†’ Network æ ‡ç­¾ â†’ å‹¾é€‰ "Disable cache"
- å³é”®åˆ·æ–°æŒ‰é’® â†’ "æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"

---

## ğŸ“Š è¯Šæ–­è¾“å‡ºè§£è¯»

### âœ… æˆåŠŸæ ‡å¿—

```
[âœ“] Frontend-init container completed successfully (Exit code: 0)
[âœ“] index.html exists
[âœ“] Found 5 JavaScript files
[âœ“] Nginx config uses Scheme B (single Nginx)
[âœ“] Frontend returns 200
[âœ“] HTML is valid
```

### âŒ å¤±è´¥æ ‡å¿—

```
[âœ—] Frontend-init container exited with error (Exit code: 1)
[âœ—] index.html not found
[âœ—] Nginx config contains 'frontend_backend' (Scheme A remnant)
[âœ—] Frontend returns 404
[âœ—] HTML is not valid
```

### âš ï¸ è­¦å‘Šæ ‡å¿—

```
[!] Frontend-init container status: running
[!] No CSS files found
[!] Vue app mount point not found
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å‰ç«¯ç™½å±é—®é¢˜æ’æŸ¥æŒ‡å—](./å‰ç«¯ç™½å±é—®é¢˜æ’æŸ¥æŒ‡å—.md) - è¯¦ç»†æ’æŸ¥æ­¥éª¤
- [å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆè¯´æ˜](./å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆè¯´æ˜.md) - æ¶æ„è¯´æ˜
- [WSL2 ç”Ÿäº§éƒ¨ç½²è¯¦ç»†æ­¥éª¤](./WSL2ç”Ÿäº§éƒ¨ç½²è¯¦ç»†æ­¥éª¤.md) - éƒ¨ç½²æ­¥éª¤

---

## ğŸ’¡ æç¤º

1. **ä¼˜å…ˆä½¿ç”¨è¯Šæ–­è„šæœ¬**ï¼šè‡ªåŠ¨æ£€æŸ¥æ‰€æœ‰å…³é”®é¡¹ï¼ŒèŠ‚çœæ—¶é—´
2. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**ï¼šè„šæœ¬ä¼šæ˜¾ç¤ºå…³é”®æ—¥å¿—ï¼Œä½†å®Œæ•´æ—¥å¿—åœ¨å®¹å™¨ä¸­
3. **æµè§ˆå™¨å¼€å‘è€…å·¥å…·**ï¼šF12 æŸ¥çœ‹ Console å’Œ Network æ ‡ç­¾
4. **WSL IP è®¿é—®**ï¼šåœ¨ macOS ä¸­é€šè¿‡ WSL IP è®¿é—®ï¼ˆ`http://<WSL_IP>/`ï¼‰

---

**æœ€åæ›´æ–°**: 2025-12-02
