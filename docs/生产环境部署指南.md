# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

æœ¬æŒ‡å—æä¾›å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…æ‹¬Dockeréƒ¨ç½²ã€Kuberneteséƒ¨ç½²ã€æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§é…ç½®ã€‚

### éƒ¨ç½²æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nginx (åå‘ä»£ç†)                      â”‚
â”‚                 è´Ÿè½½å‡è¡¡ + SSLç»ˆæ­¢                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend   â”‚  â”‚    API     â”‚
â”‚  (Nginx)    â”‚  â”‚ (FastAPI)  â”‚
â”‚  Port 8080  â”‚  â”‚ Port 8000  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚           â”‚           â”‚
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
      â”‚PostgreSQLâ”‚ â”‚ Redis  â”‚ â”‚  GPU   â”‚
      â”‚ Port 5432â”‚ â”‚Port 6379â”‚ â”‚CUDA/MPSâ”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ä¸€ã€éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©

### 1.1 æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | å¤æ‚åº¦ | å¯æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|--------|----------|----------|--------|
| **Docker Compose** | ä½ | ä¸­ | å•æœº/å°è§„æ¨¡ | â­â­â­â­â­ |
| **Kubernetes** | é«˜ | é«˜ | å¤§è§„æ¨¡/é«˜å¯ç”¨ | â­â­â­â­ |
| **è£¸æœºéƒ¨ç½²** | ä¸­ | ä½ | ç®€å•åœºæ™¯ | â­â­ |

### 1.2 æ¨èæ–¹æ¡ˆ

**ç”Ÿäº§ç¯å¢ƒæ¨è**: Docker Compose (å®Œæ•´ç‰ˆ)
- âœ… åŒ…å«æ•°æ®åº“å’ŒRedis
- âœ… GPUæ”¯æŒ
- âœ… å¥åº·æ£€æŸ¥
- âœ… è‡ªåŠ¨é‡å¯
- âœ… ç½‘ç»œéš”ç¦»

---

## ğŸ³ äºŒã€Docker Composeéƒ¨ç½²

### 2.1 å¿«é€Ÿéƒ¨ç½²

#### å‰ç½®æ¡ä»¶
```bash
# 1. æ£€æŸ¥Dockerç‰ˆæœ¬
docker --version  # >= 20.10

# 2. æ£€æŸ¥Docker Composeç‰ˆæœ¬
docker compose version  # >= 2.0

# 3. æ£€æŸ¥GPUæ”¯æŒ
nvidia-smi  # NVIDIA GPU
# æˆ–
system_profiler SPDisplaysDataType  # Apple Silicon

# 4. æ£€æŸ¥NVIDIA Container Toolkit
docker run --rm --gpus all nvidia/cuda:12.4.0-runtime-ubuntu22.04 nvidia-smi
```

#### ä¸€é”®éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <your-repo-url>
cd Pyt

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®å¯†ç å’Œå¯†é’¥

# 3. å¯åŠ¨å®Œæ•´ç”Ÿäº§ç¯å¢ƒ
docker compose -f docker-compose.prod.full.yml up -d

# 4. æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.prod.full.yml logs -f

# 5. éªŒè¯æœåŠ¡
curl http://localhost:8000/health
curl http://localhost:8080
```

### 2.2 ç¯å¢ƒå˜é‡é…ç½®

#### åˆ›å»º .env æ–‡ä»¶

```bash
# .env æ–‡ä»¶
# ============================================
# æ•°æ®åº“é…ç½®
# ============================================
POSTGRES_DB=pyt_production
POSTGRES_USER=pyt_user
POSTGRES_PASSWORD=your_secure_password_here
POSTGRES_PORT=5432

# ============================================
# Redisé…ç½®
# ============================================
REDIS_PASSWORD=your_redis_password_here
REDIS_PORT=6379

# ============================================
# APIé…ç½®
# ============================================
API_PORT=8000
SECRET_KEY=your_secret_key_here_change_me
JWT_SECRET=your_jwt_secret_here_change_me
LOG_LEVEL=INFO

# ============================================
# å‰ç«¯é…ç½®
# ============================================
FRONTEND_PORT=8080
VITE_API_BASE=/api/v1
BASE_URL=/

# ============================================
# ç”Ÿäº§ç¯å¢ƒæ ‡å¿—
# ============================================
ENVIRONMENT=production
```

#### ç”Ÿæˆå®‰å…¨å¯†é’¥

```bash
# ç”ŸæˆSECRET_KEY
python -c "import secrets; print(secrets.token_urlsafe(32))"

# ç”ŸæˆJWT_SECRET
python -c "import secrets; print(secrets.token_hex(32))"

# ç”Ÿæˆæ•°æ®åº“å¯†ç 
python -c "import secrets; print(secrets.token_urlsafe(24))"
```

### 2.3 å®Œæ•´éƒ¨ç½²é…ç½®

#### docker-compose.prod.full.yml

```yaml
version: "3.8"

networks:
  pyt-prod-network:
    driver: bridge

volumes:
  postgres_data:
    driver: local
  redis_data:
    driver: local

services:
  # PostgreSQL æ•°æ®åº“
  database:
    image: 192.168.30.83:5433/postgres:16-alpine
    container_name: pyt-postgres-prod
    environment:
      POSTGRES_DB: ${POSTGRES_DB:-pyt_production}
      POSTGRES_USER: ${POSTGRES_USER:-pyt_user}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-change_me_in_production}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./scripts/init_db.sql:/docker-entrypoint-initdb.d/init.sql:ro
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    networks:
      - pyt-prod-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-pyt_user} -d ${POSTGRES_DB:-pyt_production}"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped

  # Redis ç¼“å­˜
  redis:
    image: 192.168.30.83:5433/redis:7-alpine
    container_name: pyt-redis-prod
    command: >
      redis-server
      --appendonly yes
      --requirepass ${REDIS_PASSWORD:-change_me_in_production}
      --maxmemory 512mb
      --maxmemory-policy allkeys-lru
    volumes:
      - redis_data:/data
    ports:
      - "${REDIS_PORT:-6379}:6379"
    networks:
      - pyt-prod-network
    healthcheck:
      test: ["CMD", "redis-cli", "--raw", "incr", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5
      start_period: 5s
    restart: unless-stopped

  # åç«¯ API
  api:
    image: 192.168.30.83:5433/pyt-api:prod
    container_name: pyt-api-prod
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]
    environment:
      - ENVIRONMENT=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-pyt_user}:${POSTGRES_PASSWORD:-change_me_in_production}@database:5432/${POSTGRES_DB:-pyt_production}
      - REDIS_URL=redis://:${REDIS_PASSWORD:-change_me_in_production}@redis:6379/0
      - SECRET_KEY=${SECRET_KEY:-change_me_in_production}
      - JWT_SECRET=${JWT_SECRET:-change_me_in_production}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    ports:
      - "${API_PORT:-8000}:8000"
    volumes:
      - ./config:/app/config:ro
      - ./logs:/app/logs
      - ./output:/app/output
      - ./data:/app/data
    networks:
      - pyt-prod-network
    depends_on:
      database:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped

  # å‰ç«¯
  frontend:
    image: 192.168.30.83:5433/pyt-frontend:prod
    container_name: pyt-frontend-prod
    ports:
      - "${FRONTEND_PORT:-8080}:80"
    networks:
      - pyt-prod-network
    depends_on:
      api:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped
```

### 2.4 éƒ¨ç½²å‘½ä»¤

#### å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose -f docker-compose.prod.full.yml up -d

# å¯åŠ¨ç‰¹å®šæœåŠ¡
docker compose -f docker-compose.prod.full.yml up -d api frontend

# æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
docker compose -f docker-compose.prod.full.yml ps
```

#### ç®¡ç†æœåŠ¡

```bash
# æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.prod.full.yml logs -f
docker compose -f docker-compose.prod.full.yml logs -f api

# åœæ­¢æœåŠ¡
docker compose -f docker-compose.prod.full.yml stop

# é‡å¯æœåŠ¡
docker compose -f docker-compose.prod.full.yml restart api

# æ›´æ–°æœåŠ¡
docker compose -f docker-compose.prod.full.yml pull
docker compose -f docker-compose.prod.full.yml up -d

# åˆ é™¤æœåŠ¡ï¼ˆä¿ç•™æ•°æ®ï¼‰
docker compose -f docker-compose.prod.full.yml down

# åˆ é™¤æ‰€æœ‰ï¼ˆåŒ…æ‹¬æ•°æ®ï¼‰
docker compose -f docker-compose.prod.full.yml down -v
```

---

## ğŸš€ ä¸‰ã€Nginxåå‘ä»£ç†é…ç½®

### 3.1 Nginxé…ç½®

#### nginx.conf

```nginx
upstream api_backend {
    server pyt-api-prod:8000;
    keepalive 32;
}

upstream frontend_backend {
    server pyt-frontend-prod:80;
    keepalive 32;
}

server {
    listen 80;
    server_name your-domain.com;

    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/nginx/ssl/your-domain.crt;
    ssl_certificate_key /etc/nginx/ssl/your-domain.key;

    # SSLä¼˜åŒ–
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    # å®‰å…¨å¤´
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # æ—¥å¿—
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # å®¢æˆ·ç«¯é…ç½®
    client_max_body_size 10M;
    client_body_timeout 60s;
    client_header_timeout 60s;

    # å‰ç«¯ä»£ç†
    location / {
        proxy_pass http://frontend_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://api_backend;
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # è¶…æ—¶é…ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;

        # ç¼“å†²é…ç½®
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
        proxy_busy_buffers_size 8k;
    }

    # WebSocketæ”¯æŒ
    location /ws/ {
        proxy_pass http://api_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # WebSocketè¶…æ—¶
        proxy_read_timeout 86400;
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        proxy_pass http://api_backend/health;
        access_log off;
    }
}
```

### 3.2 æ·»åŠ Nginxåˆ°Docker Compose

```yaml
  # Nginxåå‘ä»£ç†
  nginx:
    image: 192.168.30.83:5433/nginx:1.27-alpine
    container_name: pyt-nginx-prod
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./deployment/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./deployment/nginx/ssl:/etc/nginx/ssl:ro
      - ./logs/nginx:/var/log/nginx
    networks:
      - pyt-prod-network
    depends_on:
      - api
      - frontend
    restart: unless-stopped
```

---

## ğŸ“Š å››ã€æ€§èƒ½ä¼˜åŒ–é…ç½®

### 4.1 GPUä¼˜åŒ–

#### Docker Compose GPUé…ç½®

```yaml
  api:
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
      - CUDA_VISIBLE_DEVICES=0
```

#### ç¯å¢ƒå˜é‡ä¼˜åŒ–

```bash
# .env æ–‡ä»¶æ·»åŠ 
CUDA_VISIBLE_DEVICES=0
NVIDIA_VISIBLE_DEVICES=all
NVIDIA_DRIVER_CAPABILITIES=compute,utility
PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512
TORCH_CUDNN_V8_API_ENABLED=1
```

### 4.2 æ•°æ®åº“ä¼˜åŒ–

#### PostgreSQLé…ç½®

```yaml
  database:
    environment:
      - POSTGRES_INITDB_ARGS=--encoding=UTF8 --locale=C
      - POSTGRES_SHARED_BUFFERS=256MB
      - POSTGRES_EFFECTIVE_CACHE_SIZE=1GB
      - POSTGRES_MAINTENANCE_WORK_MEM=64MB
      - POSTGRES_CHECKPOINT_COMPLETION_TARGET=0.9
      - POSTGRES_WAL_BUFFERS=16MB
      - POSTGRES_DEFAULT_STATISTICS_TARGET=100
      - POSTGRES_RANDOM_PAGE_COST=1.1
      - POSTGRES_EFFECTIVE_IO_CONCURRENCY=200
      - POSTGRES_WORK_MEM=4MB
      - POSTGRES_MIN_WAL_SIZE=1GB
      - POSTGRES_MAX_WAL_SIZE=4GB
```

### 4.3 Redisä¼˜åŒ–

#### Redisé…ç½®

```yaml
  redis:
    command: >
      redis-server
      --appendonly yes
      --requirepass ${REDIS_PASSWORD}
      --maxmemory 1gb
      --maxmemory-policy allkeys-lru
      --save 900 1
      --save 300 10
      --save 60 10000
      --tcp-keepalive 60
      --timeout 0
      --tcp-backlog 511
```

---

## ğŸ” äº”ã€ç›‘æ§å’Œæ—¥å¿—

### 5.1 å¥åº·æ£€æŸ¥

#### æ£€æŸ¥æ‰€æœ‰æœåŠ¡

```bash
# æ£€æŸ¥API
curl http://localhost:8000/health

# æ£€æŸ¥å‰ç«¯
curl http://localhost:8080

# æ£€æŸ¥æ•°æ®åº“
docker exec pyt-postgres-prod pg_isready -U pyt_user -d pyt_production

# æ£€æŸ¥Redis
docker exec pyt-redis-prod redis-cli -a your_password ping
```

#### æŸ¥çœ‹å®¹å™¨çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker compose -f docker-compose.prod.full.yml ps

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹GPUä½¿ç”¨
nvidia-smi
```

### 5.2 æ—¥å¿—ç®¡ç†

#### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker compose -f docker-compose.prod.full.yml logs -f

# æŸ¥çœ‹APIæ—¥å¿—
docker compose -f docker-compose.prod.full.yml logs -f api

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
docker compose -f docker-compose.prod.full.yml logs --tail=100 api

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´
docker compose -f docker-compose.prod.full.yml logs --since="2024-01-01T00:00:00" api
```

#### æ—¥å¿—è½®è½¬é…ç½®

```yaml
  api:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

### 5.3 æ€§èƒ½ç›‘æ§

#### åˆ›å»ºç›‘æ§è„šæœ¬

```bash
# scripts/monitoring/check_services.sh
#!/bin/bash

echo "=== æœåŠ¡å¥åº·æ£€æŸ¥ ==="
echo ""

# APIå¥åº·æ£€æŸ¥
echo "APIæœåŠ¡:"
curl -s http://localhost:8000/health | jq . || echo "APIæœåŠ¡å¼‚å¸¸"

echo ""
echo "å‰ç«¯æœåŠ¡:"
curl -s -o /dev/null -w "%{http_code}" http://localhost:8080
echo ""

echo "æ•°æ®åº“:"
docker exec pyt-postgres-prod pg_isready -U pyt_user -d pyt_production

echo ""
echo "Redis:"
docker exec pyt-redis-prod redis-cli -a $REDIS_PASSWORD ping

echo ""
echo "=== èµ„æºä½¿ç”¨æƒ…å†µ ==="
docker stats --no-stream
```

---

## ğŸ”’ å…­ã€å®‰å…¨é…ç½®

### 6.1 é˜²ç«å¢™é…ç½®

```bash
# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

### 6.2 SSLè¯ä¹¦é…ç½®

#### ä½¿ç”¨Let's Encrypt

```bash
# å®‰è£…Certbot
sudo apt-get install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

#### ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼ˆæµ‹è¯•ï¼‰

```bash
# ç”Ÿæˆè¯ä¹¦
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /path/to/ssl/your-domain.key \
  -out /path/to/ssl/your-domain.crt
```

### 6.3 å®‰å…¨åŠ å›º

#### ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡

```yaml
  api:
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp
```

---

## ğŸ”„ ä¸ƒã€æ›´æ–°å’Œå›æ»š

### 7.1 æ›´æ–°æµç¨‹

```bash
# 1. å¤‡ä»½æ•°æ®
docker exec pyt-postgres-prod pg_dump -U pyt_user pyt_production > backup_$(date +%Y%m%d).sql

# 2. æ‹‰å–æ–°é•œåƒ
docker compose -f docker-compose.prod.full.yml pull

# 3. åœæ­¢æœåŠ¡
docker compose -f docker-compose.prod.full.yml stop api

# 4. å¯åŠ¨æ–°ç‰ˆæœ¬
docker compose -f docker-compose.prod.full.yml up -d api

# 5. éªŒè¯æœåŠ¡
curl http://localhost:8000/health

# 6. å¦‚æœæ­£å¸¸ï¼Œæ›´æ–°å…¶ä»–æœåŠ¡
docker compose -f docker-compose.prod.full.yml up -d
```

### 7.2 å›æ»šæµç¨‹

```bash
# 1. åœæ­¢å½“å‰æœåŠ¡
docker compose -f docker-compose.prod.full.yml stop api

# 2. ä½¿ç”¨æ—§é•œåƒ
docker tag 192.168.30.83:5433/pyt-api:prod-old 192.168.30.83:5433/pyt-api:prod

# 3. å¯åŠ¨æ—§ç‰ˆæœ¬
docker compose -f docker-compose.prod.full.yml up -d api

# 4. éªŒè¯æœåŠ¡
curl http://localhost:8000/health
```

---

## ğŸ“ˆ å…«ã€æ‰©å±•å’Œè´Ÿè½½å‡è¡¡

### 8.1 æ°´å¹³æ‰©å±•

```bash
# æ‰©å±•APIæœåŠ¡åˆ°3ä¸ªå®ä¾‹
docker compose -f docker-compose.prod.full.yml up -d --scale api=3

# æŸ¥çœ‹æ‰©å±•çŠ¶æ€
docker compose -f docker-compose.prod.full.yml ps
```

### 8.2 Nginxè´Ÿè½½å‡è¡¡

```nginx
upstream api_backend {
    least_conn;  # æœ€å°‘è¿æ¥ç®—æ³•
    server pyt-api-prod_1:8000;
    server pyt-api-prod_2:8000;
    server pyt-api-prod_3:8000;
    keepalive 32;
}
```

---

## ğŸ¯ ä¹ã€å®Œæ•´éƒ¨ç½²æ£€æŸ¥æ¸…å•

### 9.1 éƒ¨ç½²å‰æ£€æŸ¥

- [ ] Dockerå’ŒDocker Composeå·²å®‰è£…
- [ ] NVIDIAé©±åŠ¨å’ŒContainer Toolkitå·²å®‰è£…
- [ ] GPUæµ‹è¯•é€šè¿‡
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] å¯†é’¥å·²ç”Ÿæˆ
- [ ] SSLè¯ä¹¦å·²å‡†å¤‡
- [ ] é˜²ç«å¢™å·²é…ç½®
- [ ] åŸŸåå·²è§£æ

### 9.2 éƒ¨ç½²åéªŒè¯

- [ ] æ‰€æœ‰æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] APIå¯ä»¥è®¿é—®
- [ ] å‰ç«¯å¯ä»¥è®¿é—®
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] Redisè¿æ¥æ­£å¸¸
- [ ] GPUæ­£å¸¸å·¥ä½œ
- [ ] æ—¥å¿—æ­£å¸¸è¾“å‡º
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸

---

## ğŸ“ åã€æ•…éšœæ’é™¤

### 10.1 å¸¸è§é—®é¢˜

#### GPUä¸å¯ç”¨

```bash
# æ£€æŸ¥GPU
nvidia-smi

# æµ‹è¯•GPUå®¹å™¨
docker run --rm --gpus all nvidia/cuda:12.4.0-runtime-ubuntu22.04 nvidia-smi

# æ£€æŸ¥Container Toolkit
docker info | grep -i runtime
```

#### æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.prod.full.yml logs api

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tulpn | grep 8000

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker compose -f docker-compose.prod.full.yml ps
```

#### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker exec pyt-postgres-prod pg_isready -U pyt_user

# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker network inspect pyt-prod-network

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker compose -f docker-compose.prod.full.yml logs database
```

---

## ğŸ‰ æ€»ç»“

### å¿«é€Ÿéƒ¨ç½²å‘½ä»¤

```bash
# 1. é…ç½®ç¯å¢ƒ
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# 2. å¯åŠ¨æœåŠ¡
docker compose -f docker-compose.prod.full.yml up -d

# 3. æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.prod.full.yml logs -f

# 4. éªŒè¯æœåŠ¡
curl http://localhost:8000/health
curl http://localhost:8080
```

### è®¿é—®åœ°å€

- **å‰ç«¯**: http://your-domain.com æˆ– http://localhost:8080
- **API**: http://your-domain.com/api/v1 æˆ– http://localhost:8000/api/v1
- **APIæ–‡æ¡£**: http://your-domain.com/docs æˆ– http://localhost:8000/docs

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-15
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
