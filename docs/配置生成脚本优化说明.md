# é…ç½®ç”Ÿæˆè„šæœ¬ä¼˜åŒ–è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

å¯¹ `scripts/generate_production_config.sh` è¿›è¡Œäº†ä¸‰é¡¹å…³é”®ä¼˜åŒ–ï¼Œæå‡è„šæœ¬çš„è‡ªåŠ¨åŒ–ç¨‹åº¦å’Œç”¨æˆ·ä½“éªŒã€‚

## âœ… å·²å®ç°çš„æ”¹è¿›

### 1. è‡ªåŠ¨æ¢æµ‹å®¿ä¸»æœº UID/GID

**é—®é¢˜**ï¼š
- ä¹‹å‰ç¡¬ç¼–ç  `HOST_UID=1000` å’Œ `HOST_GID=1000`
- å¦‚æœå®¿ä¸»æœºç”¨æˆ· UID ä¸æ˜¯ 1000ï¼Œä¼šå¯¼è‡´ `frontend-init` å®¹å™¨æå–çš„æ–‡ä»¶æƒé™ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `id -u` å’Œ `id -g` è‡ªåŠ¨è·å–å½“å‰è¿è¡Œè„šæœ¬ç”¨æˆ·çš„ UID/GID
- ç¡®ä¿ `frontend-init` æå–çš„æ–‡ä»¶æƒé™ä¸å½“å‰ç”¨æˆ·å®Œç¾åŒ¹é…
- å½»åº•æ ¹é™¤æƒé™é—®é¢˜

**å®ç°ä»£ç **ï¼š
```bash
# Auto-detect host user UID/GID
HOST_UID=$(id -u)
HOST_GID=$(id -g)
echo -e "${BLUE}[INFO]${NC} Auto-detected host user: UID=${HOST_UID}, GID=${HOST_GID}"
```

**é…ç½®è¾“å‡º**ï¼š
```bash
# ==================== Host User Configuration ====================
# å®¿ä¸»æœºç”¨æˆ· UID/GIDï¼ˆç”¨äº frontend-init å®¹å™¨è®¾ç½®æ–‡ä»¶æƒé™ï¼‰
# è‡ªåŠ¨æ¢æµ‹å½“å‰è¿è¡Œè„šæœ¬ç”¨æˆ·çš„ UID/GIDï¼Œç¡®ä¿æ–‡ä»¶æƒé™ä¸å½“å‰ç”¨æˆ·å®Œç¾åŒ¹é…
# å¦‚éœ€æ‰‹åŠ¨ä¿®æ”¹ï¼Œè¯·ä½¿ç”¨: id -u (è·å– UID), id -g (è·å– GID)
HOST_UID=${HOST_UID}
HOST_GID=${HOST_GID}
```

### 2. æ”¯æŒéäº¤äº’æ¨¡å¼ï¼ˆCI/CD å‹å¥½ï¼‰

**é—®é¢˜**ï¼š
- è„šæœ¬éœ€è¦ç”¨æˆ·äº¤äº’ç¡®è®¤ï¼Œæ— æ³•åœ¨ CI/CD æµç¨‹ä¸­è‡ªåŠ¨åŒ–è°ƒç”¨
- å¦‚æœ `.env.production` å·²å­˜åœ¨ï¼Œéœ€è¦æ‰‹åŠ¨è¾“å…¥ç¡®è®¤

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ·»åŠ  `-y` / `--yes` å‚æ•°æ”¯æŒéäº¤äº’æ¨¡å¼
- éäº¤äº’æ¨¡å¼ä¸‹è‡ªåŠ¨ä½¿ç”¨é»˜è®¤å€¼ï¼Œæ— éœ€ç”¨æˆ·è¾“å…¥
- è‡ªåŠ¨è¦†ç›–å·²å­˜åœ¨çš„é…ç½®æ–‡ä»¶ï¼ˆä¼šå…ˆå¤‡ä»½ï¼‰

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# äº¤äº’æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
bash scripts/generate_production_config.sh

# éäº¤äº’æ¨¡å¼ï¼ˆCI/CD å‹å¥½ï¼‰
bash scripts/generate_production_config.sh -y
bash scripts/generate_production_config.sh --yes
```

**å®ç°é€»è¾‘**ï¼š
```bash
# è§£æå‘½ä»¤è¡Œå‚æ•°
NON_INTERACTIVE=false
while [[ $# -gt 0 ]]; do
    case $1 in
        -y|--yes)
            NON_INTERACTIVE=true
            shift
            ;;
        -h|--help)
            # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
            ;;
    esac
done

# éäº¤äº’æ¨¡å¼ä¸‹çš„å¤„ç†
if [ "$NON_INTERACTIVE" = false ]; then
    # äº¤äº’å¼è¾“å…¥
    read -p "API Port [8000]: " API_PORT
    # ...
else
    # ä½¿ç”¨é»˜è®¤å€¼
    API_PORT=8000
    ADMIN_USERNAME=admin
    CORS_ORIGINS=*
    IMAGE_TAG=latest
fi
```

### 3. é…ç½®é¡¹å¯¹é½ï¼šPostgreSQL å¼‚æ­¥é©±åŠ¨æ”¯æŒ

**é—®é¢˜**ï¼š
- é…ç½®æ–‡ä»¶ä¸­åªæœ‰æ ‡å‡† PostgreSQL é©±åŠ¨è¿æ¥å­—ç¬¦ä¸²
- å¯¹äºä½¿ç”¨ FastAPI/Uvicorn çš„åº”ç”¨ï¼Œå¼‚æ­¥é©±åŠ¨ï¼ˆ`postgresql+asyncpg`ï¼‰æ€§èƒ½æ›´å¥½
- ç¼ºå°‘ç›¸å…³è¯´æ˜å’Œç¤ºä¾‹

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨æ•°æ®åº“é…ç½®éƒ¨åˆ†æ·»åŠ è¯¦ç»†æ³¨é‡Š
- è¯´æ˜æ ‡å‡†é©±åŠ¨å’Œå¼‚æ­¥é©±åŠ¨çš„åŒºåˆ«
- æä¾›å¼‚æ­¥é©±åŠ¨çš„ç¤ºä¾‹é…ç½®ï¼ˆæ³¨é‡Šå½¢å¼ï¼‰
- æé†’éœ€è¦å®‰è£… `asyncpg` é©±åŠ¨

**é…ç½®è¾“å‡º**ï¼š
```bash
# ==================== Database Configuration ====================
# PostgreSQL è¿æ¥å­—ç¬¦ä¸²
# æ ‡å‡†é©±åŠ¨: postgresql://user:password@host:port/database
# å¼‚æ­¥é©±åŠ¨ (æ¨èç”¨äº FastAPI/Uvicorn): postgresql+asyncpg://user:password@host:port/database
# æ³¨æ„: å¦‚æœä½¿ç”¨å¼‚æ­¥é©±åŠ¨ï¼Œéœ€è¦ç¡®ä¿å®‰è£…äº† asyncpg é©±åŠ¨: pip install asyncpg
DATABASE_URL=postgresql://pepgmp_prod:${DATABASE_PASSWORD}@database:5432/pepgmp_production
# DATABASE_URL=postgresql+asyncpg://pepgmp_prod:${DATABASE_PASSWORD}@database:5432/pepgmp_production
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### äº¤äº’æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
```bash
bash scripts/generate_production_config.sh
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
=========================================================================
Generate Production Environment Configuration
=========================================================================

[INFO] Auto-detected host user: UID=1000, GID=1000

Please enter configuration (press Enter for default values):

API Port [8000]:
Admin Username [admin]:
CORS Origins [*]:
Image Tag [latest]:

Generating strong random passwords...
âœ“ Password generation completed
```

### éäº¤äº’æ¨¡å¼ï¼ˆCI/CDï¼‰
```bash
bash scripts/generate_production_config.sh -y
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
=========================================================================
Generate Production Environment Configuration
=========================================================================

[INFO] Auto-detected host user: UID=1000, GID=1000

Non-interactive mode: using default values
  API Port: 8000
  Admin Username: admin
  CORS Origins: *
  Image Tag: latest

Generating strong random passwords...
âœ“ Password generation completed
```

### æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
```bash
bash scripts/generate_production_config.sh --help
```

è¾“å‡ºï¼š
```
Usage: scripts/generate_production_config.sh [-y]
  -y, --yes    Non-interactive mode, automatically overwrite existing file
  -h, --help   Show this help message
```

## ğŸ” éªŒè¯

### è¯­æ³•æ£€æŸ¥
```bash
bash -n scripts/generate_production_config.sh
```

### åŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•å¸®åŠ©ä¿¡æ¯
bash scripts/generate_production_config.sh --help

# æµ‹è¯•éäº¤äº’æ¨¡å¼ï¼ˆä¼šç”Ÿæˆé…ç½®æ–‡ä»¶ï¼‰
bash scripts/generate_production_config.sh -y

# æ£€æŸ¥ç”Ÿæˆçš„ UID/GID
grep "HOST_UID\|HOST_GID" .env.production
```

## ğŸ¯ ä¼˜åŠ¿æ€»ç»“

1. **è‡ªåŠ¨åŒ–ç¨‹åº¦æå‡**ï¼š
   - è‡ªåŠ¨æ¢æµ‹ UID/GIDï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
   - æ”¯æŒéäº¤äº’æ¨¡å¼ï¼Œé€‚åˆ CI/CD æµç¨‹

2. **ç”¨æˆ·ä½“éªŒæ”¹å–„**ï¼š
   - æ¸…æ™°çš„å¸®åŠ©ä¿¡æ¯
   - è¯¦ç»†çš„é…ç½®æ³¨é‡Š
   - è‡ªåŠ¨å¤‡ä»½å·²å­˜åœ¨çš„é…ç½®æ–‡ä»¶

3. **é…ç½®çµæ´»æ€§**ï¼š
   - æ”¯æŒæ ‡å‡†é©±åŠ¨å’Œå¼‚æ­¥é©±åŠ¨
   - æä¾›æ¸…æ™°çš„é…ç½®è¯´æ˜å’Œç¤ºä¾‹

4. **æƒé™é—®é¢˜æ ¹é™¤**ï¼š
   - è‡ªåŠ¨åŒ¹é…å½“å‰ç”¨æˆ·æƒé™
   - å½»åº•è§£å†³ `frontend-init` æ–‡ä»¶æƒé™é—®é¢˜

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç¬¬2å¤©è¿ç»´é—®é¢˜ä¿®å¤æ–¹æ¡ˆ](./ç¬¬2å¤©è¿ç»´é—®é¢˜ä¿®å¤æ–¹æ¡ˆ.md)
- [å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆè¯´æ˜](./å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆè¯´æ˜.md)
- [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—](./ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—.md)
