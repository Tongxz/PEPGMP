# 配置文件审计报告

## 📊 配置文件分类

### 🔴 应该迁移到数据库的配置（动态配置）

#### 1. 相机配置 (`config/cameras.yaml`) ⚠️ **需要迁移**

**当前状态**:
- 存储方式: YAML文件 + 数据库（双重存储）
- 问题: 数据一致性检查显示不一致
- 使用频率: 高频修改（通过API）

**迁移理由**:
- ✅ 频繁修改（API操作）
- ✅ 需要并发控制
- ✅ 需要数据一致性保证
- ✅ 需要审计日志
- ✅ 已存在DDD架构和Repository模式

**迁移优先级**: 🔴 **高优先级**

---

#### 2. 区域配置 (`config/regions.json`) ⚠️ **建议迁移**

**当前状态**:
- 存储方式: JSON文件
- 使用方式: 通过RegionService和RegionManager管理
- 包含内容:
  - 区域定义（polygon、type、name）
  - 规则配置（rules）
  - 统计信息（stats）- 这部分应该在数据库中

**迁移理由**:
- ✅ 包含统计信息（应该实时存储在数据库）
- ✅ 可能频繁修改
- ✅ 需要并发访问
- ✅ 需要数据一致性

**迁移优先级**: 🟡 **中优先级**

**建议**:
- 区域定义和规则 → 迁移到数据库
- 统计信息 → 应该已经在数据库中（检查）

---

### 🟢 保留在文件的配置（静态配置）

#### 3. 统一参数配置 (`config/unified_params.yaml`) ✅ **保留在文件**

**内容**:
- 算法参数（human_detection、hairnet_detection、behavior_recognition等）
- 系统参数（batch_size、cache_size等）
- 检测规则参数（detection_rules）

**保留理由**:
- ✅ 算法配置参数，不需要频繁修改
- ✅ 适合版本控制（Git）
- ✅ 可以按环境区分（dev/prod）
- ✅ 易于调试和查看
- ✅ 不涉及用户操作

**建议**: 保留在文件，可通过API读取

---

#### 4. 增强检测配置 (`config/enhanced_detection_config.yaml`) ✅ **保留在文件**

**内容**:
- 算法增强参数
- 优化配置

**保留理由**:
- ✅ 算法配置参数
- ✅ 不涉及用户操作
- ✅ 适合版本控制

**建议**: 保留在文件

---

#### 5. 用户配置 (`config/user_profiles/`) ⚠️ **待分析**

**内容**:
- 用户配置文件（JSON）

**分析**:
- 需要检查是否应该迁移到数据库
- 如果涉及用户数据，应该存储在数据库

**建议**: 进一步分析使用场景

---

## 📋 迁移计划

### 阶段1: 相机配置迁移（立即执行）

**优先级**: 🔴 **高优先级**

**步骤**:
1. ✅ 创建数据迁移脚本
2. ✅ 从YAML导入到数据库
3. ✅ 重构CameraService（移除YAML写入）
4. ✅ 验证功能正常
5. ✅ 更新健康检查（移除一致性检查）

**预计时间**: 2-4小时

---

### 阶段2: 区域配置分析（短期）

**优先级**: 🟡 **中优先级**

**步骤**:
1. 检查区域统计信息是否已在数据库
2. 分析区域配置的使用频率
3. 评估迁移的必要性
4. 如需要，执行迁移

**预计时间**: 1-2小时

---

### 阶段3: 用户配置分析（中期）

**优先级**: 🟢 **低优先级**

**步骤**:
1. 检查用户配置的使用场景
2. 分析是否需要迁移到数据库

**预计时间**: 1小时

---

## 🎯 配置文件分类总结

| 配置文件 | 存储方式 | 迁移优先级 | 理由 |
|---------|---------|-----------|------|
| `cameras.yaml` | Database | 🔴 **高** | 频繁修改、数据一致性问题 |
| `regions.json` | Database | 🟡 **中** | 包含统计信息、可能频繁修改 |
| `unified_params.yaml` | File | ✅ **保留** | 算法参数、适合版本控制 |
| `enhanced_detection_config.yaml` | File | ✅ **保留** | 算法参数、适合版本控制 |
| `user_profiles/` | TBD | 🟢 **待分析** | 需要进一步分析 |

---

## 📝 决策原则

### 应该存储在数据库的配置：

✅ **动态配置**（需要频繁修改）
✅ **用户操作产生的配置**（API创建/更新）
✅ **包含统计信息的配置**（实时数据）
✅ **需要并发控制的配置**（多实例部署）
✅ **需要审计日志的配置**（变更历史）

### 应该保留在文件的配置：

✅ **算法参数配置**（不常修改）
✅ **系统默认配置**（启动时加载）
✅ **环境特定配置**（dev/prod区分）
✅ **适合版本控制的配置**（Git追踪）

---

**更新日期**: 2025-11-03
**状态**: 审计完成，准备执行迁移
