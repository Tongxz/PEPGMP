# 模型文件分析报告

## 📊 总览

**总大小**: 约 8.2GB
**分析日期**: 2025-12-03

---

## ✅ 生产环境必要模型（约 400MB）

### 1. YOLO 检测模型 (`models/yolo/` - 约 180MB)

**用途**: 人体检测、目标检测、训练基座模型
**文件**:
- `yolov8n.pt` (6.2MB) - 轻量级，默认使用
- `yolov8s.pt` (22MB) - 小型，平衡速度和精度 ⭐ **推荐**
- `yolov8m.pt` (50MB) - 中型，更高精度
- `yolov8l.pt` (84MB) - 大型，最高精度
- `yolov8n-pose.pt` (6.5MB) - 姿态检测模型
- `yolo11n.pt` (5.4MB) - YOLO11 新版本

**代码引用**:
- `src/config/unified_params.py`: `model_path: "models/yolo/yolov8s.pt"`
- `src/application/detection_initializer.py`: `models/yolo/yolov8n.pt`
- `src/utils/hardware_probe.py`: 根据硬件自动选择模型

**重要说明**:
- ✅ **全部保留**: YOLO 目录内的所有模型都需要保留
- 🎯 **训练基座**: 这些模型可能作为后续训练的基座模型（fine-tuning）
- 📦 **完整保留**: 生产环境应保留完整的 YOLO 模型集合，以支持不同的使用场景和训练需求

**建议**:
- ✅ **必须保留**: 所有 YOLO 模型文件（包括 yolo11n.pt 等新版本）

---

### 2. 发网检测模型 (`models/hairnet_detection/` - 50MB)

**用途**: 发网佩戴检测
**文件**:
- `hairnet_detection.pt` (50MB)

**代码引用**:
- `src/detection/hairnet_detection_factory.py`: `models/hairnet_detection/hairnet_detection.pt`
- `src/detection/yolo_hairnet_detector.py`: `models/hairnet_detection/hairnet_detection.pt`

**建议**: ✅ **必须保留**

---

### 3. 用户训练的发网模型 (`models/hairnet_model/` - 109MB)

**用途**: 用户自定义训练的发网检测模型
**文件**:
- `weights/best.pt` (50MB) - 最佳模型
- `weights/last.pt` (50MB) - 最新模型
- `args.yaml` - 训练参数
- `results.csv` - 训练结果

**代码引用**: 可能被配置覆盖使用

**建议**:
- ✅ **保留**: `weights/best.pt` (如果使用自定义模型)
- ⚠️ **可选**: `weights/last.pt` (备份)
- ⚠️ **可选**: 其他配置文件

---

### 4. 洗手检测模型 (`models/handwash_xgb.*` - 约 1.2MB)

**用途**: 洗手行为识别（XGBoost 模型）
**文件**:
- `handwash_xgb.joblib.real` (308KB) ⭐ **生产使用**
- `handwash_xgb.json` (596KB) - JSON 格式（备用）
- `handwash_xgb.joblib` (596KB) - 旧格式
- `handwash_xgb.joblib.backup` (308KB) - 备份

**代码引用**:
- `src/config/unified_params.py`: `ml_model_path: "models/handwash_xgb.joblib.real"`
- `src/core/behavior.py`: 支持 `.joblib.real` 格式

**建议**:
- ✅ **必须保留**: `handwash_xgb.joblib.real`
- ❌ **可删除**: `handwash_xgb.joblib.backup` (备份文件)
- ⚠️ **可选**: `handwash_xgb.json` (如果代码支持 JSON 格式)

---

## ❌ 测试/训练模型（约 7.8GB - 可删除）

### 1. 多行为识别训练运行 (`models/multi_behavior/runs/` - 约 7.5GB)

**用途**: 训练过程中的检查点文件
**内容**:
- 多个训练运行的完整 epoch 权重文件
- 每个 epoch 约 64MB
- 包含 100+ 个 epoch 检查点

**文件示例**:
```
models/multi_behavior/runs/
├── multi_behavior_20251117_030615/weights/
│   ├── epoch0.pt (64MB)
│   ├── epoch1.pt (64MB)
│   ├── ...
│   ├── best.pt (64MB)
│   └── last.pt (64MB)
├── multi_behavior_20251117_032019/weights/
│   └── ... (100+ epoch 文件)
└── multi_behavior_20251117_035648/weights/
    └── ... (100+ epoch 文件)
```

**代码引用**: 仅在训练时使用，生产环境不需要

**建议**:
- ❌ **删除**: `models/multi_behavior/runs/` (训练检查点)
- ✅ **保留**: `models/multi_behavior/multi_behavior_20251118_070707.pt` (最终训练模型，如果使用)

---

### 2. MLOps 训练运行 (`models/mlops/runs/` - 约 40MB)

**用途**: MLOps 训练实验记录
**内容**: 训练运行记录和检查点

**建议**:
- ❌ **删除**: `models/mlops/runs/` (训练实验记录)
- ⚠️ **可选**: `models/mlops/reports/` (如果需要保留报告)

---

### 3. 其他测试文件

**文件**:
- `models/.DS_Store` (8KB) - macOS 系统文件
- `models/handwash/` (空目录)
- `models/behavior_recognition/` (空目录)
- `models/pose_detection/` (空目录)

**建议**:
- ❌ **删除**: `.DS_Store`
- ⚠️ **可选**: 空目录可以保留（用于未来扩展）

---

## 📋 清理建议

### 方案 A: 最小化生产环境（推荐）

**保留** (~400MB):
```
models/
├── yolo/
│   ├── yolov8n.pt (6MB)
│   └── yolov8s.pt (22MB) ⭐
├── hairnet_detection/
│   └── hairnet_detection.pt (50MB)
├── hairnet_model/
│   └── weights/
│       └── best.pt (50MB) [如果使用]
└── handwash_xgb.joblib.real (308KB) ⭐
```

**删除** (~7.8GB):
- `models/multi_behavior/runs/` (7.5GB)
- `models/mlops/runs/` (40MB)
- `models/handwash_xgb.joblib.backup` (308KB)
- `models/.DS_Store` (8KB)

### 方案 B: 保留训练模型

**额外保留**:
- `models/multi_behavior/multi_behavior_20251118_070707.pt` (50MB) - 如果生产环境需要使用

---

## 🛠️ 清理脚本

### 自动清理脚本

```bash
#!/bin/bash
# 清理测试/训练模型文件

cd /Users/zhou/Code/Pyt

echo "=== 清理训练运行文件 ==="

# 删除训练检查点
echo "删除 multi_behavior/runs/ ..."
rm -rf models/multi_behavior/runs/
echo "已删除: ~7.5GB"

# 删除 MLOps 运行记录
echo "删除 mlops/runs/ ..."
rm -rf models/mlops/runs/
echo "已删除: ~40MB"

# 删除备份文件
echo "删除备份文件 ..."
rm -f models/handwash_xgb.joblib.backup
echo "已删除: ~308KB"

# 删除系统文件
echo "删除系统文件 ..."
find models -name ".DS_Store" -delete
echo "已删除: ~8KB"

echo ""
echo "=== 清理完成 ==="
echo "预计释放空间: ~7.8GB"
echo ""
echo "保留的必要模型:"
du -sh models/yolo models/hairnet_detection models/hairnet_model models/handwash_xgb.joblib.real 2>/dev/null
```

---

## 📊 清理前后对比

| 项目 | 清理前 | 清理后 | 节省 |
|------|--------|--------|------|
| **总大小** | 8.2GB | ~400MB | **7.8GB** |
| **必要模型** | 400MB | 400MB | - |
| **训练文件** | 7.8GB | 0 | **7.8GB** |

---

## ⚠️ 注意事项

1. **备份重要模型**: 清理前请备份 `models/hairnet_model/weights/best.pt` 和 `models/multi_behavior/multi_behavior_*.pt`（如果使用）

2. **训练文件**: `runs/` 目录包含完整的训练历史，如果未来需要恢复训练，请先备份

3. **生产环境**: 生产环境只需要推理模型，不需要训练检查点

4. **版本控制**: 模型文件已在 `.gitignore` 中排除，不会提交到 Git

---

## 🔍 验证必要模型

运行以下命令验证必要模型是否存在：

```bash
# 检查必要模型
echo "=== 必要模型检查 ==="
echo ""
echo "YOLO 模型:"
ls -lh models/yolo/yolov8*.pt 2>/dev/null || echo "  ⚠️ 缺失"
echo ""
echo "发网检测模型:"
ls -lh models/hairnet_detection/hairnet_detection.pt 2>/dev/null || echo "  ⚠️ 缺失"
echo ""
echo "洗手检测模型:"
ls -lh models/handwash_xgb.joblib.real 2>/dev/null || echo "  ⚠️ 缺失"
echo ""
echo "用户训练模型 (可选):"
ls -lh models/hairnet_model/weights/best.pt 2>/dev/null || echo "  ⚠️ 未使用自定义模型"
```

---

**最后更新**: 2025-12-03
