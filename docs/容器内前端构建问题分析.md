# å®¹å™¨å†…å‰ç«¯æ„å»ºé—®é¢˜åˆ†æ

## ğŸ“‹ é—®é¢˜æè¿°

**ç°è±¡**ï¼š
- âœ… æœ¬åœ°æ„å»ºæ­£å¸¸ï¼Œé¡µé¢å¯ä»¥æ­£å¸¸æ˜¾ç¤º
- âŒ å®¹å™¨å†…æ„å»ºçš„é•œåƒæ— æ³•æ˜¾ç¤ºé¡µé¢ï¼ˆç™½å±æˆ–é”™è¯¯ï¼‰

## ğŸ” é—®é¢˜åˆ†æ

### å‘ç°çš„é—®é¢˜

1. **æ„å»ºäº§ç‰©ä¸ä¸€è‡´**
   - **å®¹å™¨å†…æ„å»ºçš„é•œåƒ**ï¼ˆ`pepgmp-frontend:20251204`ï¼‰ï¼š
     - ä½¿ç”¨ç®€åŒ–ä»£ç åˆ†å‰²ç­–ç•¥ï¼ˆåªæœ‰ä¸€ä¸ª `vendor` chunkï¼‰
     - `index.html` å¼•ç”¨ï¼š`index-DNWKwqY0.js`

   - **éƒ¨ç½²ç›®å½•ä¸­çš„æ–‡ä»¶**ï¼ˆ`frontend/dist`ï¼‰ï¼š
     - ä½¿ç”¨æ—§çš„å¤æ‚åˆ†å‰²ç­–ç•¥ï¼ˆå¤šä¸ª chunkï¼š`vue-vendor`, `ui-layout`, `ui-feedback` ç­‰ï¼‰
     - `index.html` å¼•ç”¨ï¼š`index-CB_U11Bj.js`
     - **è¿™äº›æ–‡ä»¶æ˜¯æ—§çš„æ„å»ºäº§ç‰©**

2. **æ–‡ä»¶æå–é—®é¢˜**
   - `frontend-init` å®¹å™¨å¯èƒ½æ²¡æœ‰æ­£ç¡®æ›´æ–°æ–‡ä»¶
   - æˆ–è€…æå–äº†ä½† Nginx è¿˜åœ¨ä½¿ç”¨æ—§æ–‡ä»¶

3. **Nginx æ—¥å¿—æ˜¾ç¤º**
   - æ­£åœ¨æœåŠ¡æ—§çš„æ„å»ºäº§ç‰©ï¼ˆ`index-DteXJffF.js`ï¼‰
   - è¿™äº›æ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨æˆ–æœ‰é—®é¢˜

### æ ¹æœ¬åŸå› 

**éƒ¨ç½²ç›®å½•ä¸­çš„æ–‡ä»¶æ˜¯æ—§çš„ï¼Œ`frontend-init` å®¹å™¨æ²¡æœ‰æ­£ç¡®æ›´æ–°æ–‡ä»¶**

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ³• 1: æ¸…ç†å¹¶é‡æ–°æå–ï¼ˆæ¨èï¼‰

```bash
# 1. æ¸…ç†æ—§æ–‡ä»¶
rm -rf frontend/dist/*

# 2. é‡æ–°æå–é™æ€æ–‡ä»¶
docker compose -f docker-compose.prod.yml --env-file .env.production up frontend-init

# 3. é‡å¯ Nginx
docker compose -f docker-compose.prod.yml --env-file .env.production restart nginx
```

### æ–¹æ³• 2: æ‰‹åŠ¨æå–æ–‡ä»¶

```bash
# æ‰‹åŠ¨è¿è¡Œå®¹å™¨æå–æ–‡ä»¶
docker run --rm \
  -v $(pwd)/frontend/dist:/target \
  -e HOST_UID=$(id -u) \
  -e HOST_GID=$(id -g) \
  pepgmp-frontend:20251204 \
  sh -c "cp -r /usr/share/nginx/html/* /target/ && chown -R \${HOST_UID}:\${HOST_GID} /target"
```

### æ–¹æ³• 3: å®Œå…¨é‡æ–°éƒ¨ç½²

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker compose -f docker-compose.prod.yml --env-file .env.production down

# æ¸…ç†æ—§æ–‡ä»¶
rm -rf frontend/dist/*

# é‡æ–°å¯åŠ¨ï¼ˆä¼šè‡ªåŠ¨è¿è¡Œ frontend-initï¼‰
docker compose -f docker-compose.prod.yml --env-file .env.production up -d
```

---

## ğŸ” éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥æå–çš„æ–‡ä»¶

```bash
# æ£€æŸ¥æ–°çš„ index.html
cat frontend/dist/index.html

# åº”è¯¥çœ‹åˆ°ï¼š
# - ä½¿ç”¨ç®€åŒ–ç­–ç•¥ï¼ˆåªæœ‰ä¸€ä¸ª vendor chunkï¼‰
# - å¼•ç”¨ index-DNWKwqY0.jsï¼ˆæˆ–ç±»ä¼¼çš„ hashï¼‰
```

### 2. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨

```bash
# è·å–å¼•ç”¨çš„ JS æ–‡ä»¶
JS_FILE=$(grep -o 'src="[^"]*"' frontend/dist/index.html | sed 's/src="//;s/"//' | sed 's|^/||')

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
[ -f "frontend/dist/$JS_FILE" ] && echo "âœ… å­˜åœ¨" || echo "âŒ ä¸å­˜åœ¨"
```

### 3. æµ‹è¯• HTTP è®¿é—®

```bash
# æµ‹è¯•æ ¹è·¯å¾„
curl -I http://localhost/

# åº”è¯¥è¿”å›: HTTP/1.1 200 OK

# æµ‹è¯• index.html
curl -s http://localhost/ | head -20
```

### 4. æµè§ˆå™¨éªŒè¯

1. **æ‰“å¼€æµè§ˆå™¨**ï¼šè®¿é—® `http://localhost/`
2. **æ‰“å¼€å¼€å‘è€…å·¥å…·** (F12)
3. **æ£€æŸ¥ Console**ï¼š
   - æ˜¯å¦æœ‰çº¢è‰²é”™è¯¯ï¼Ÿ
   - æ˜¯å¦æœ‰é»„è‰²è­¦å‘Šï¼Ÿ
4. **æ£€æŸ¥ Network**ï¼š
   - åˆ·æ–°é¡µé¢ (F5)
   - æ‰€æœ‰èµ„æºæ˜¯å¦è¿”å› 200ï¼Ÿ
   - æ˜¯å¦æœ‰ 404 æˆ– 500 é”™è¯¯ï¼Ÿ
5. **æµ‹è¯•é¡µé¢åŠŸèƒ½**ï¼š
   - é¡µé¢æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºï¼Ÿ
   - è·¯ç”±æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: æ–‡ä»¶æå–åè¿˜æ˜¯æ—§æ–‡ä»¶

**åŸå› **ï¼š
- æ–‡ä»¶è¢«ç¼“å­˜
- Nginx æ²¡æœ‰é‡æ–°åŠ è½½

**è§£å†³**ï¼š
```bash
# é‡å¯ Nginx
docker compose -f docker-compose.prod.yml --env-file .env.production restart nginx

# æˆ–å®Œå…¨é‡å¯
docker compose -f docker-compose.prod.yml --env-file .env.production down
docker compose -f docker-compose.prod.yml --env-file .env.production up -d
```

### é—®é¢˜ 2: æµè§ˆå™¨ç¼“å­˜å¯¼è‡´ç™½å±

**åŸå› **ï¼š
- æµè§ˆå™¨ç¼“å­˜äº†æ—§çš„ `index.html`
- æ—§çš„ `index.html` å¼•ç”¨çš„æ–‡ä»¶ä¸å­˜åœ¨

**è§£å†³**ï¼š
- **ç¡¬åˆ·æ–°**ï¼š`Ctrl+Shift+R` (Windows/Linux) æˆ– `Cmd+Shift+R` (Mac)
- **æˆ–ä½¿ç”¨æ— ç—•æ¨¡å¼**ï¼š`Ctrl+Shift+N` (Chrome)

### é—®é¢˜ 3: æ–‡ä»¶æƒé™é—®é¢˜

**åŸå› **ï¼š
- æ–‡ä»¶æ‰€æœ‰è€…ä¸æ­£ç¡®
- æ–‡ä»¶æƒé™ä¸è¶³

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la frontend/dist/

# ä¿®å¤æƒé™
sudo chown -R $(id -u):$(id -g) frontend/dist/
chmod -R 755 frontend/dist/
```

---

## ğŸ“ é¢„é˜²æªæ–½

### 1. ç¡®ä¿ä½¿ç”¨æœ€æ–°é•œåƒ

```bash
# æ£€æŸ¥é•œåƒç‰ˆæœ¬
docker images | grep pepgmp-frontend

# ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬
# åœ¨ .env.production ä¸­è®¾ç½®ï¼š
# IMAGE_TAG=20251204
```

### 2. æ¯æ¬¡æ›´æ–°é•œåƒåé‡æ–°æå–

```bash
# æ„å»ºæ–°é•œåƒå
bash scripts/build_prod_only.sh 20251204

# æ¸…ç†å¹¶é‡æ–°æå–
rm -rf frontend/dist/*
docker compose -f docker-compose.prod.yml --env-file .env.production up frontend-init
docker compose -f docker-compose.prod.yml --env-file .env.production restart nginx
```

### 3. éªŒè¯æå–çš„æ–‡ä»¶

```bash
# æ£€æŸ¥æ–‡ä»¶æ•°é‡
find frontend/dist -type f | wc -l

# åº”è¯¥çœ‹åˆ°çº¦ 36 ä¸ªæ–‡ä»¶ï¼ˆæ ¹æ®æ„å»ºäº§ç‰©ï¼‰

# æ£€æŸ¥ index.html
cat frontend/dist/index.html | grep -E "vendor|index"
```

---

## âœ… ä¿®å¤åçš„éªŒè¯æ¸…å•

- [ ] `frontend/dist/index.html` ä½¿ç”¨ç®€åŒ–ç­–ç•¥ï¼ˆåªæœ‰ä¸€ä¸ª vendor chunkï¼‰
- [ ] å¼•ç”¨çš„ JS æ–‡ä»¶å­˜åœ¨
- [ ] æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆ1000:1000 æˆ–å½“å‰ç”¨æˆ·ï¼‰
- [ ] Nginx å·²é‡å¯
- [ ] HTTP è®¿é—®è¿”å› 200
- [ ] æµè§ˆå™¨ä¸­é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] æ§åˆ¶å°æ— é”™è¯¯
- [ ] ç½‘ç»œè¯·æ±‚éƒ½è¿”å› 200

---

**æœ€åæ›´æ–°**: 2025-12-04
