# å¼€å‘ç¯å¢ƒé…ç½®æ›´æ–°æŒ‡å—

**æ›´æ–°æ—¶é—´**: 2025-12-04  
**é—®é¢˜**: å®¹å™¨åå’Œæ•°æ®åº“ç”¨æˆ·åå·²æ›´æ–°ä¸º `pepgmp-*`ï¼Œä½† `.env` æ–‡ä»¶ä»ä½¿ç”¨æ—§é…ç½®

---

## ğŸ” é—®é¢˜åˆ†æ

ä»å¯åŠ¨æ—¥å¿—ä¸­å‘ç°çš„é—®é¢˜ï¼š

1. **æ•°æ®åº“è®¤è¯å¤±è´¥**:
   ```
   ERROR: password authentication failed for user "pyt_dev"
   ```
   - `.env` æ–‡ä»¶ä»ä½¿ç”¨ï¼š`pyt_dev` / `pyt_development`
   - å®¹å™¨å·²é…ç½®ä¸ºï¼š`pepgmp_dev` / `pepgmp_development`

2. **Redis è®¤è¯å¤±è´¥**:
   ```
   ERROR: invalid username-password pair or user is disabled
   ```
   - `.env` æ–‡ä»¶ä»ä½¿ç”¨ï¼š`pyt_dev_redis`
   - å®¹å™¨å·²é…ç½®ä¸ºï¼š`pepgmp_dev_redis`

3. **å®¹å™¨åç§°å†²çª**:
   ```
   Error: The container name "/pepgmp-redis-dev" is already in use
   ```

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤ 1: åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨

```bash
# åœæ­¢æ‰€æœ‰ç›¸å…³å®¹å™¨
docker stop pepgmp-postgres-dev pepgmp-redis-dev 2>/dev/null || true

# åˆ é™¤æ—§å®¹å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
docker rm pepgmp-postgres-dev pepgmp-redis-dev 2>/dev/null || true

# æˆ–è€…å¼ºåˆ¶åˆ é™¤
docker rm -f pepgmp-postgres-dev pepgmp-redis-dev 2>/dev/null || true
```

### æ­¥éª¤ 2: æ›´æ–° `.env` æ–‡ä»¶é…ç½®

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ›´æ–°ä»¥ä¸‹é…ç½®é¡¹ï¼š

**æ—§é…ç½®**:
```bash
DATABASE_URL=postgresql://pyt_dev:pyt_dev_password@localhost:5432/pyt_development
REDIS_URL=redis://:pyt_dev_redis@localhost:6379/0
```

**æ–°é…ç½®**ï¼ˆæ›´æ–°ä¸ºï¼‰:
```bash
DATABASE_URL=postgresql://pepgmp_dev:pepgmp_dev_password@localhost:5432/pepgmp_development
REDIS_URL=redis://:pepgmp_dev_redis@localhost:6379/0
```

**å®Œæ•´çš„æ•°æ®åº“é…ç½®æ›´æ–°**:
```bash
# æ•°æ®åº“é…ç½®
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=pepgmp_development
DATABASE_USER=pepgmp_dev
DATABASE_PASSWORD=pepgmp_dev_password
DATABASE_URL=postgresql://pepgmp_dev:pepgmp_dev_password@localhost:5432/pepgmp_development

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=pepgmp_dev_redis
REDIS_URL=redis://:pepgmp_dev_redis@localhost:6379/0
```

### æ­¥éª¤ 3: éªŒè¯ Docker å®¹å™¨é…ç½®

ç¡®è®¤ `docker-compose.yml` ä¸­çš„é…ç½®ï¼ˆå·²æ›´æ–°ï¼‰:

```yaml
# PostgreSQL
POSTGRES_DB: pepgmp_development
POSTGRES_USER: pepgmp_dev
POSTGRES_PASSWORD: pepgmp_dev_password

# Redis
--requirepass pepgmp_dev_redis
```

### æ­¥éª¤ 4: é‡æ–°å¯åŠ¨å¼€å‘ç¯å¢ƒ

```bash
# é‡æ–°å¯åŠ¨å¼€å‘ç¯å¢ƒ
bash scripts/start_dev.sh
```

---

## ğŸ”§ å¿«é€Ÿä¿®å¤è„šæœ¬

æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶è„šæœ¬æ¥æ›´æ–° `.env` æ–‡ä»¶ï¼š

```bash
#!/bin/bash
# å¿«é€Ÿæ›´æ–° .env æ–‡ä»¶é…ç½®

cd /Users/zhou/Code/PEPGMP

# å¤‡ä»½å½“å‰ .env æ–‡ä»¶
cp .env .env.backup.$(date +%Y%m%d_%H%M%S)

# æ›´æ–°æ•°æ®åº“é…ç½®
sed -i.bak 's|pyt_dev:pyt_dev_password|pepgmp_dev:pepgmp_dev_password|g' .env
sed -i.bak 's|pyt_development|pepgmp_development|g' .env
sed -i.bak 's|pyt_dev_redis|pepgmp_dev_redis|g' .env

# æ¸…ç†å¤‡ä»½æ–‡ä»¶
rm -f .env.bak

echo "âœ… .env æ–‡ä»¶å·²æ›´æ–°"
echo ""
echo "æ›´æ–°åçš„é…ç½®:"
grep -E "DATABASE_URL|REDIS_URL" .env
```

**ä½¿ç”¨æ–¹æ³•**:
```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x fix_env_config.sh

# è¿è¡Œè„šæœ¬
./fix_env_config.sh
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®åº“æ•°æ®è¿ç§»

å¦‚æœæ‚¨çš„æ•°æ®åº“ä¸­å·²æœ‰æ•°æ®ï¼š

**é€‰é¡¹ A**: ä¿ç•™æ—§æ•°æ®ï¼ˆæ¨èï¼‰
```bash
# åœ¨æ•°æ®åº“ä¸­åˆ›å»ºæ–°ç”¨æˆ·å¹¶æˆäºˆæƒé™
docker exec -it pepgmp-postgres-dev psql -U postgres -c "
CREATE USER pepgmp_dev WITH PASSWORD 'pepgmp_dev_password';
ALTER DATABASE pyt_development RENAME TO pepgmp_development;
GRANT ALL PRIVILEGES ON DATABASE pepgmp_development TO pepgmp_dev;
"
```

**é€‰é¡¹ B**: é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼ˆä¼šä¸¢å¤±æ•°æ®ï¼‰
```bash
# åœæ­¢å®¹å™¨
docker stop pepgmp-postgres-dev

# åˆ é™¤æ•°æ®å·
docker volume rm pepgmp_postgres_dev_data

# é‡æ–°å¯åŠ¨å®¹å™¨ï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„æ•°æ®åº“å’Œç”¨æˆ·ï¼‰
docker-compose up -d database
```

### 2. Redis æ•°æ®

Redis æ•°æ®é€šå¸¸åœ¨å†…å­˜ä¸­ï¼Œé‡æ–°å¯åŠ¨å®¹å™¨å³å¯ã€‚

---

## ğŸ“‹ é…ç½®å¯¹æ¯”è¡¨

| é…ç½®é¡¹ | æ—§é…ç½® | æ–°é…ç½® |
|--------|--------|--------|
| æ•°æ®åº“ç”¨æˆ· | `pyt_dev` | `pepgmp_dev` |
| æ•°æ®åº“å | `pyt_development` | `pepgmp_development` |
| æ•°æ®åº“å¯†ç  | `pyt_dev_password` | `pepgmp_dev_password` |
| Redis å¯†ç  | `pyt_dev_redis` | `pepgmp_dev_redis` |
| å®¹å™¨åï¼ˆPostgreSQLï¼‰ | `pyt-postgres-dev` | `pepgmp-postgres-dev` |
| å®¹å™¨åï¼ˆRedisï¼‰ | `pyt-redis-dev` | `pepgmp-redis-dev` |

---

## ğŸ” éªŒè¯ä¿®å¤

ä¿®å¤åï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

1. **éªŒè¯ .env æ–‡ä»¶**:
   ```bash
   grep -E "DATABASE_URL|REDIS_URL" .env
   ```

2. **éªŒè¯å®¹å™¨é…ç½®**:
   ```bash
   docker exec pepgmp-postgres-dev psql -U pepgmp_dev -d pepgmp_development -c "SELECT version();"
   docker exec pepgmp-redis-dev redis-cli -a pepgmp_dev_redis ping
   ```

3. **é‡æ–°å¯åŠ¨æœåŠ¡**:
   ```bash
   bash scripts/start_dev.sh
   ```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Dockerå®¹å™¨åç»Ÿä¸€ä¿®æ”¹å®ŒæˆæŠ¥å‘Š](Dockerå®¹å™¨åç»Ÿä¸€ä¿®æ”¹å®ŒæˆæŠ¥å‘Š.md)
- [é¡¹ç›®é‡å‘½åæŒ‡å—](é¡¹ç›®é‡å‘½åæŒ‡å—.md)

