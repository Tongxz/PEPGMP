# äººä½“è¡Œä¸ºæ£€æµ‹ç³»ç»Ÿæ¶æ„å›¾

## æ€»ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·å±‚ User Layer"
        WEB[Webå‰ç«¯<br/>HTML/CSS/JS]
        CLI[å‘½ä»¤è¡Œç•Œé¢<br/>CLI]
        API_CLIENT[APIå®¢æˆ·ç«¯<br/>Third-party Apps]
    end

    subgraph "æ¥å£å±‚ API Layer"
        FASTAPI[FastAPIåº”ç”¨<br/>app.py]
        WS[WebSocketæœåŠ¡<br/>websocket_service.py]

        subgraph "ä¸­é—´ä»¶ Middleware"
            ERR_MW[é”™è¯¯å¤„ç†ä¸­é—´ä»¶<br/>error_middleware.py]
            SEC_MW[å®‰å…¨ä¸­é—´ä»¶<br/>security_middleware.py]
            CORS[CORSä¸­é—´ä»¶]
        end

        subgraph "è·¯ç”± Routers"
            R_DETECT[æ£€æµ‹è·¯ç”±<br/>comprehensive.py]
            R_CAMERA[æ‘„åƒå¤´è·¯ç”±<br/>cameras.py]
            R_REGION[åŒºåŸŸç®¡ç†<br/>region_management.py]
            R_STATS[ç»Ÿè®¡è·¯ç”±<br/>statistics.py]
            R_EVENTS[äº‹ä»¶è·¯ç”±<br/>events.py]
            R_SYSTEM[ç³»ç»Ÿè·¯ç”±<br/>system.py]
            R_SECURITY[å®‰å…¨è·¯ç”±<br/>security.py]
            R_MONITOR[ç›‘æ§è·¯ç”±<br/>error_monitoring.py]
        end
    end

    subgraph "ä¸šåŠ¡æœåŠ¡å±‚ Service Layer"
        DETECT_SVC[æ£€æµ‹æœåŠ¡<br/>detection_service.py]
        CAPTURE_SVC[æ•è·æœåŠ¡<br/>capture_service.py]
        REGION_SVC[åŒºåŸŸæœåŠ¡<br/>region_service.py]
        VIDEO_SVC[è§†é¢‘æœåŠ¡<br/>video_service.py]
        PROC_MGR[è¿›ç¨‹ç®¡ç†å™¨<br/>process_manager.py]
        PROC_ENG[è¿›ç¨‹å¼•æ“<br/>process_engine.py]
        RT_VIDEO[å®æ—¶è§†é¢‘æ£€æµ‹<br/>realtime_video_detection.py]
    end

    subgraph "æ ¸å¿ƒæ£€æµ‹å±‚ Core Detection Layer"
        subgraph "æ£€æµ‹ç®¡çº¿ Detection Pipelines"
            OPT_PIPE[ä¼˜åŒ–æ£€æµ‹ç®¡çº¿<br/>OptimizedDetectionPipeline]
            ACC_PIPE[åŠ é€Ÿæ£€æµ‹ç®¡çº¿<br/>AcceleratedDetectionPipeline]
            FAST_PIPE[å¿«é€Ÿæ£€æµ‹ç®¡çº¿<br/>FastDetectionPipeline]
        end

        subgraph "æ ¸å¿ƒç»„ä»¶ Core Components"
            BEHAVIOR[è¡Œä¸ºè¯†åˆ«å™¨<br/>BehaviorRecognizer]
            TRACKER[ç›®æ ‡è·Ÿè¸ªå™¨<br/>ObjectTracker]
            REGION[åŒºåŸŸç®¡ç†å™¨<br/>RegionManager]
            RULE_ENG[è§„åˆ™å¼•æ“<br/>RuleEngine]
            QUALITY[è´¨é‡è¯„ä¼°å™¨<br/>QualityAssessor]
            PERSON_ENG[ä¸ªæ€§åŒ–å¼•æ“<br/>PersonalizationEngine]
            DATA_MGR[æ•°æ®ç®¡ç†å™¨<br/>DataManager]
        end
    end

    subgraph "æ£€æµ‹å™¨å±‚ Detector Layer"
        HUMAN_DET[äººä½“æ£€æµ‹å™¨<br/>HumanDetector<br/>YOLO]
        POSE_DET[å§¿æ€æ£€æµ‹å™¨<br/>PoseDetector<br/>MediaPipe/YOLOv8]
        HAIRNET_DET[å‘ç½‘æ£€æµ‹å™¨<br/>YOLOHairnetDetector]
        HAND_DET[æ‰‹éƒ¨æ£€æµ‹å™¨<br/>EnhancedHandDetector]
        MOTION_ANA[è¿åŠ¨åˆ†æå™¨<br/>MotionAnalyzer]
        DEEP_BEH[æ·±åº¦è¡Œä¸ºè¯†åˆ«<br/>DeepBehaviorRecognizer]
    end

    subgraph "æ¶æ„å¢å¼ºå±‚ Architecture Layer"
        DI[ä¾èµ–æ³¨å…¥<br/>DependencyInjection]
        EVENT_SYS[äº‹ä»¶ç³»ç»Ÿ<br/>EventSystem]
        PLUGIN_SYS[æ’ä»¶ç³»ç»Ÿ<br/>PluginSystem]
        ARCH_ANA[æ¶æ„åˆ†æå™¨<br/>ArchitectureAnalyzer]
    end

    subgraph "ç›‘æ§å®‰å…¨å±‚ Monitoring & Security Layer"
        ADV_MON[é«˜çº§ç›‘æ§<br/>AdvancedMonitoring]
        STRUCT_LOG[ç»“æ„åŒ–æ—¥å¿—<br/>StructuredLogging]
        ERR_MON[é”™è¯¯ç›‘æ§<br/>ErrorMonitor]
        ERR_HANDLER[é”™è¯¯å¤„ç†å™¨<br/>ErrorHandler]
        SEC_MGR[å®‰å…¨ç®¡ç†å™¨<br/>SecurityManager]
    end

    subgraph "å·¥å…·å±‚ Utility Layer"
        GPU_ACC[GPUåŠ é€Ÿ<br/>GPUAcceleration]
        ADAPTIVE_OPT[è‡ªé€‚åº”ä¼˜åŒ–<br/>AdaptiveOptimizer]
        HW_PROBE[ç¡¬ä»¶æ¢æµ‹<br/>HardwareProbe]
        IMG_UTILS[å›¾åƒå·¥å…·<br/>ImageUtils]
        VIDEO_UTILS[è§†é¢‘å·¥å…·<br/>VideoUtils]
        FILE_UTILS[æ–‡ä»¶å·¥å…·<br/>FileUtils]
        DATA_COLLECT[æ•°æ®æ”¶é›†å™¨<br/>DataCollector]
    end

    subgraph "é…ç½®å±‚ Configuration Layer"
        UNIFIED_CFG[ç»Ÿä¸€å‚æ•°<br/>UnifiedParams]
        MODEL_CFG[æ¨¡å‹é…ç½®<br/>ModelConfig]
        CAMERA_CFG[æ‘„åƒå¤´é…ç½®<br/>CameraConfig]
        SETTINGS[è®¾ç½®<br/>Settings]
    end

    subgraph "æ•°æ®å­˜å‚¨å±‚ Data Storage Layer"
        DB[(SQLiteæ•°æ®åº“<br/>detection_results.db)]
        FILES[æ–‡ä»¶å­˜å‚¨<br/>Videos/Images]
        CACHE[ç¼“å­˜<br/>Redis/Memory]
    end

    subgraph "AIæ¨¡å‹å±‚ AI Models Layer"
        YOLO_HUMAN[YOLOv8äººä½“æ£€æµ‹<br/>yolov8n.pt]
        YOLO_HAIRNET[YOLOv8å‘ç½‘æ£€æµ‹<br/>hairnet_best.pt]
        MEDIAPIPE[MediaPipeå§¿æ€<br/>pose_landmarker]
        XGB_MODEL[XGBoostè¡Œä¸º<br/>handwash_xgb.json]
    end

    %% ç”¨æˆ·å±‚åˆ°æ¥å£å±‚
    WEB --> FASTAPI
    CLI --> FASTAPI
    API_CLIENT --> FASTAPI
    WEB --> WS

    %% æ¥å£å±‚åˆ°ä¸­é—´ä»¶
    FASTAPI --> ERR_MW
    FASTAPI --> SEC_MW
    FASTAPI --> CORS

    %% ä¸­é—´ä»¶åˆ°è·¯ç”±
    ERR_MW --> R_DETECT
    ERR_MW --> R_CAMERA
    ERR_MW --> R_REGION
    ERR_MW --> R_STATS
    ERR_MW --> R_EVENTS
    ERR_MW --> R_SYSTEM
    ERR_MW --> R_SECURITY
    ERR_MW --> R_MONITOR

    %% è·¯ç”±åˆ°æœåŠ¡å±‚
    R_DETECT --> DETECT_SVC
    R_CAMERA --> CAPTURE_SVC
    R_CAMERA --> PROC_MGR
    R_REGION --> REGION_SVC
    R_STATS --> DETECT_SVC
    R_EVENTS --> DETECT_SVC
    WS --> RT_VIDEO

    %% æœåŠ¡å±‚åˆ°æ ¸å¿ƒæ£€æµ‹å±‚
    DETECT_SVC --> OPT_PIPE
    DETECT_SVC --> ACC_PIPE
    CAPTURE_SVC --> FAST_PIPE
    RT_VIDEO --> OPT_PIPE
    PROC_MGR --> PROC_ENG
    PROC_ENG --> OPT_PIPE

    %% æ£€æµ‹ç®¡çº¿åˆ°æ ¸å¿ƒç»„ä»¶
    OPT_PIPE --> BEHAVIOR
    OPT_PIPE --> TRACKER
    OPT_PIPE --> REGION
    OPT_PIPE --> RULE_ENG
    ACC_PIPE --> QUALITY
    ACC_PIPE --> PERSON_ENG
    FAST_PIPE --> DATA_MGR

    %% æ ¸å¿ƒç»„ä»¶åˆ°æ£€æµ‹å™¨å±‚
    BEHAVIOR --> HUMAN_DET
    BEHAVIOR --> POSE_DET
    BEHAVIOR --> HAIRNET_DET
    TRACKER --> HUMAN_DET
    REGION --> HAND_DET
    RULE_ENG --> MOTION_ANA
    QUALITY --> DEEP_BEH

    %% æ£€æµ‹å™¨å±‚åˆ°AIæ¨¡å‹å±‚
    HUMAN_DET --> YOLO_HUMAN
    HAIRNET_DET --> YOLO_HAIRNET
    POSE_DET --> MEDIAPIPE
    BEHAVIOR --> XGB_MODEL

    %% æ¶æ„å¢å¼ºå±‚
    DI --> DETECT_SVC
    DI --> CAPTURE_SVC
    EVENT_SYS --> OPT_PIPE
    PLUGIN_SYS --> FASTAPI
    ARCH_ANA --> DI

    %% ç›‘æ§å®‰å…¨å±‚
    ADV_MON --> FASTAPI
    STRUCT_LOG --> FASTAPI
    ERR_MON --> ERR_HANDLER
    ERR_HANDLER --> FASTAPI
    SEC_MGR --> SEC_MW
    R_SECURITY --> SEC_MGR
    R_MONITOR --> ERR_MON

    %% å·¥å…·å±‚
    GPU_ACC --> HUMAN_DET
    GPU_ACC --> POSE_DET
    ADAPTIVE_OPT --> OPT_PIPE
    HW_PROBE --> GPU_ACC
    IMG_UTILS --> HUMAN_DET
    VIDEO_UTILS --> CAPTURE_SVC
    FILE_UTILS --> VIDEO_SVC
    DATA_COLLECT --> ADV_MON

    %% é…ç½®å±‚
    UNIFIED_CFG --> OPT_PIPE
    MODEL_CFG --> HUMAN_DET
    CAMERA_CFG --> CAPTURE_SVC
    SETTINGS --> FASTAPI

    %% æ•°æ®å­˜å‚¨å±‚
    DETECT_SVC --> DB
    VIDEO_SVC --> FILES
    OPT_PIPE --> CACHE
    DATA_MGR --> DB

    %% æ ·å¼å®šä¹‰
    classDef userLayer fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef apiLayer fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef serviceLayer fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef coreLayer fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    classDef detectorLayer fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef architectureLayer fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef monitoringLayer fill:#e0f2f1,stroke:#004d40,stroke-width:2px
    classDef utilityLayer fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef configLayer fill:#ede7f6,stroke:#311b92,stroke-width:2px
    classDef dataLayer fill:#efebe9,stroke:#3e2723,stroke-width:2px
    classDef modelLayer fill:#ffebee,stroke:#b71c1c,stroke-width:2px

    class WEB,CLI,API_CLIENT userLayer
    class FASTAPI,WS,ERR_MW,SEC_MW,CORS,R_DETECT,R_CAMERA,R_REGION,R_STATS,R_EVENTS,R_SYSTEM,R_SECURITY,R_MONITOR apiLayer
    class DETECT_SVC,CAPTURE_SVC,REGION_SVC,VIDEO_SVC,PROC_MGR,PROC_ENG,RT_VIDEO serviceLayer
    class OPT_PIPE,ACC_PIPE,FAST_PIPE,BEHAVIOR,TRACKER,REGION,RULE_ENG,QUALITY,PERSON_ENG,DATA_MGR coreLayer
    class HUMAN_DET,POSE_DET,HAIRNET_DET,HAND_DET,MOTION_ANA,DEEP_BEH detectorLayer
    class DI,EVENT_SYS,PLUGIN_SYS,ARCH_ANA architectureLayer
    class ADV_MON,STRUCT_LOG,ERR_MON,ERR_HANDLER,SEC_MGR monitoringLayer
    class GPU_ACC,ADAPTIVE_OPT,HW_PROBE,IMG_UTILS,VIDEO_UTILS,FILE_UTILS,DATA_COLLECT utilityLayer
    class UNIFIED_CFG,MODEL_CFG,CAMERA_CFG,SETTINGS configLayer
    class DB,FILES,CACHE dataLayer
    class YOLO_HUMAN,YOLO_HAIRNET,MEDIAPIPE,XGB_MODEL modelLayer
```

## æ•°æ®æµå›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·/å‰ç«¯
    participant API as FastAPI
    participant Middleware as ä¸­é—´ä»¶
    participant Service as æ£€æµ‹æœåŠ¡
    participant Pipeline as æ£€æµ‹ç®¡çº¿
    participant Detector as æ£€æµ‹å™¨
    participant Model as AIæ¨¡å‹
    participant Storage as æ•°æ®å­˜å‚¨

    User->>API: å‘èµ·æ£€æµ‹è¯·æ±‚
    API->>Middleware: è¯·æ±‚éªŒè¯
    Middleware->>Middleware: å®‰å…¨æ£€æŸ¥
    Middleware->>Middleware: é”™è¯¯å¤„ç†
    Middleware->>Service: è½¬å‘è¯·æ±‚
    Service->>Pipeline: åˆå§‹åŒ–æ£€æµ‹ç®¡çº¿

    loop è§†é¢‘å¸§å¤„ç†
        Pipeline->>Detector: äººä½“æ£€æµ‹
        Detector->>Model: YOLOæ¨ç†
        Model-->>Detector: æ£€æµ‹ç»“æœ

        Pipeline->>Detector: å§¿æ€æ£€æµ‹
        Detector->>Model: MediaPipeæ¨ç†
        Model-->>Detector: å…³é”®ç‚¹æ•°æ®

        Pipeline->>Detector: å‘ç½‘æ£€æµ‹
        Detector->>Model: YOLOæ¨ç†
        Model-->>Detector: å‘ç½‘ç»“æœ

        Pipeline->>Pipeline: è¡Œä¸ºè¯†åˆ«
        Pipeline->>Pipeline: ç›®æ ‡è·Ÿè¸ª
        Pipeline->>Pipeline: è§„åˆ™åˆ¤æ–­

        Pipeline->>Storage: ä¿å­˜ç»“æœ
    end

    Pipeline-->>Service: è¿”å›æ£€æµ‹ç»“æœ
    Service-->>API: è¿”å›å“åº”
    API-->>User: è¿”å›ç»“æœ
```

## æ¨¡å—ä¾èµ–å›¾

```mermaid
graph LR
    subgraph "æ ¸å¿ƒæ¨¡å—"
        A[main.py]
        B[api/app.py]
        C[services/]
        D[core/]
        E[detection/]
    end

    subgraph "å¢å¼ºæ¨¡å—"
        F[architecture/]
        G[monitoring/]
        H[security/]
        I[utils/]
    end

    subgraph "é…ç½®æ¨¡å—"
        J[config/]
    end

    subgraph "å¤–éƒ¨ä¾èµ–"
        K[FastAPI]
        L[Ultralytics]
        M[MediaPipe]
        N[PyTorch]
        O[XGBoost]
    end

    A --> B
    A --> C
    A --> J
    B --> C
    B --> F
    B --> G
    B --> H
    C --> D
    C --> E
    D --> E
    D --> I
    E --> I
    F --> C
    G --> B
    H --> B
    I --> J

    B --> K
    E --> L
    E --> M
    E --> N
    D --> O

    classDef coreModule fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    classDef enhanceModule fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef configModule fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef externalModule fill:#ffccbc,stroke:#d84315,stroke-width:2px

    class A,B,C,D,E coreModule
    class F,G,H,I enhanceModule
    class J configModule
    class K,L,M,N,O externalModule
```

## æ£€æµ‹ç®¡çº¿æµç¨‹å›¾

```mermaid
flowchart TD
    Start([å¼€å§‹æ£€æµ‹]) --> Input[è¾“å…¥è§†é¢‘å¸§]

    Input --> GPU{GPUå¯ç”¨?}
    GPU -->|æ˜¯| AccPipeline[åŠ é€Ÿæ£€æµ‹ç®¡çº¿]
    GPU -->|å¦| OptPipeline[ä¼˜åŒ–æ£€æµ‹ç®¡çº¿]

    AccPipeline --> BatchProcess[æ‰¹å¤„ç†]
    OptPipeline --> SingleProcess[å•å¸§å¤„ç†]

    BatchProcess --> HumanDetect[äººä½“æ£€æµ‹<br/>YOLOv8]
    SingleProcess --> HumanDetect

    HumanDetect --> HasHuman{æ£€æµ‹åˆ°äººä½“?}
    HasHuman -->|å¦| NextFrame[ä¸‹ä¸€å¸§]
    HasHuman -->|æ˜¯| PoseDetect[å§¿æ€æ£€æµ‹<br/>MediaPipe/YOLOv8]

    PoseDetect --> HeadROI[æå–å¤´éƒ¨ROI]
    HeadROI --> HairnetDetect[å‘ç½‘æ£€æµ‹<br/>YOLO]

    PoseDetect --> HandROI[æå–æ‰‹éƒ¨ROI]
    HandROI --> HandDetect[æ‰‹éƒ¨æ£€æµ‹]

    PoseDetect --> MotionAnalyze[è¿åŠ¨åˆ†æ]

    HairnetDetect --> BehaviorRecog[è¡Œä¸ºè¯†åˆ«<br/>XGBoost]
    HandDetect --> BehaviorRecog
    MotionAnalyze --> BehaviorRecog

    BehaviorRecog --> Tracking[ç›®æ ‡è·Ÿè¸ª]
    Tracking --> RuleEngine[è§„åˆ™å¼•æ“]

    RuleEngine --> RegionCheck{åŒºåŸŸæ£€æŸ¥}
    RegionCheck -->|è¿è§„| SaveEvent[ä¿å­˜äº‹ä»¶]
    RegionCheck -->|æ­£å¸¸| UpdateStats[æ›´æ–°ç»Ÿè®¡]

    SaveEvent --> Cache[æ›´æ–°ç¼“å­˜]
    UpdateStats --> Cache

    Cache --> NextFrame
    NextFrame --> Input

    NextFrame --> End([ç»“æŸæ£€æµ‹])

    classDef processNode fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef decisionNode fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef detectionNode fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef resultNode fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px

    class Input,BatchProcess,SingleProcess,HeadROI,HandROI,Cache processNode
    class GPU,HasHuman,RegionCheck decisionNode
    class HumanDetect,PoseDetect,HairnetDetect,HandDetect,BehaviorRecog detectionNode
    class SaveEvent,UpdateStats,Tracking,RuleEngine resultNode
```

## æ€§èƒ½ä¼˜åŒ–æ¶æ„å›¾

```mermaid
graph TB
    subgraph "æ€§èƒ½ä¼˜åŒ–å±‚"
        GPU_Layer[GPUåŠ é€Ÿå±‚]
        Cache_Layer[ç¼“å­˜å±‚]
        Batch_Layer[æ‰¹å¤„ç†å±‚]
        Async_Layer[å¼‚æ­¥å¤„ç†å±‚]
    end

    subgraph "è‡ªé€‚åº”ä¼˜åŒ–"
        HW_Probe[ç¡¬ä»¶æ¢æµ‹]
        Profile_Select[é…ç½®é€‰æ‹©<br/>Fast/Balanced/Accurate]
        Dynamic_Adjust[åŠ¨æ€è°ƒæ•´]
    end

    subgraph "GPUä¼˜åŒ–"
        CUDA_Opt[CUDAä¼˜åŒ–]
        MPS_Opt[MPSä¼˜åŒ–<br/>Apple Silicon]
        TRT_Opt[TensorRTä¼˜åŒ–]
        Mixed_Precision[æ··åˆç²¾åº¦]
    end

    subgraph "æ¨ç†ä¼˜åŒ–"
        Model_Compile[æ¨¡å‹ç¼–è¯‘]
        Batch_Inference[æ‰¹é‡æ¨ç†]
        Pipeline_Parallel[ç®¡çº¿å¹¶è¡Œ]
        Memory_Opt[å†…å­˜ä¼˜åŒ–]
    end

    GPU_Layer --> CUDA_Opt
    GPU_Layer --> MPS_Opt
    GPU_Layer --> TRT_Opt
    GPU_Layer --> Mixed_Precision

    Cache_Layer --> Batch_Layer
    Batch_Layer --> Async_Layer

    HW_Probe --> Profile_Select
    Profile_Select --> Dynamic_Adjust
    Dynamic_Adjust --> GPU_Layer

    GPU_Layer --> Model_Compile
    Batch_Layer --> Batch_Inference
    Async_Layer --> Pipeline_Parallel
    Cache_Layer --> Memory_Opt

    classDef optLayer fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef adaptiveLayer fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    classDef gpuLayer fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef inferenceLayer fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px

    class GPU_Layer,Cache_Layer,Batch_Layer,Async_Layer optLayer
    class HW_Probe,Profile_Select,Dynamic_Adjust adaptiveLayer
    class CUDA_Opt,MPS_Opt,TRT_Opt,Mixed_Precision gpuLayer
    class Model_Compile,Batch_Inference,Pipeline_Parallel,Memory_Opt inferenceLayer
```

## ç›‘æ§ä¸å®‰å…¨æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç›‘æ§ç³»ç»Ÿ"
        System_Mon[ç³»ç»Ÿç›‘æ§<br/>CPU/GPU/å†…å­˜]
        App_Mon[åº”ç”¨ç›‘æ§<br/>å»¶è¿Ÿ/ååé‡]
        Business_Mon[ä¸šåŠ¡ç›‘æ§<br/>æ£€æµ‹ç»Ÿè®¡]
        Log_Mon[æ—¥å¿—ç›‘æ§<br/>ç»“æ„åŒ–æ—¥å¿—]
    end

    subgraph "å‘Šè­¦ç³»ç»Ÿ"
        Alert_Rule[å‘Šè­¦è§„åˆ™]
        Alert_Channel[å‘Šè­¦æ¸ é“<br/>Webhook/Email/Log]
        Alert_History[å‘Šè­¦å†å²]
    end

    subgraph "é”™è¯¯å¤„ç†"
        Error_Handler[ç»Ÿä¸€é”™è¯¯å¤„ç†]
        Error_Recovery[é”™è¯¯æ¢å¤ç­–ç•¥]
        Error_Track[é”™è¯¯è¿½è¸ª]
        Error_Report[é”™è¯¯æŠ¥å‘Š]
    end

    subgraph "å®‰å…¨ç³»ç»Ÿ"
        Auth[èº«ä»½è®¤è¯<br/>JWT]
        Access_Control[è®¿é—®æ§åˆ¶<br/>RBAC]
        Threat_Detect[å¨èƒæ£€æµ‹<br/>SQLæ³¨å…¥/XSS]
        Rate_Limit[é€Ÿç‡é™åˆ¶]
        Encryption[åŠ å¯†ç³»ç»Ÿ<br/>å¯†ç /ä»¤ç‰Œ]
    end

    subgraph "æ•°æ®æ”¶é›†"
        Metrics_Collect[æŒ‡æ ‡æ”¶é›†]
        Log_Collect[æ—¥å¿—æ”¶é›†]
        Event_Collect[äº‹ä»¶æ”¶é›†]
    end

    System_Mon --> Metrics_Collect
    App_Mon --> Metrics_Collect
    Business_Mon --> Metrics_Collect
    Log_Mon --> Log_Collect

    Metrics_Collect --> Alert_Rule
    Log_Collect --> Alert_Rule
    Event_Collect --> Alert_Rule

    Alert_Rule --> Alert_Channel
    Alert_Channel --> Alert_History

    Error_Handler --> Error_Recovery
    Error_Handler --> Error_Track
    Error_Track --> Error_Report

    Auth --> Access_Control
    Access_Control --> Threat_Detect
    Threat_Detect --> Rate_Limit
    Rate_Limit --> Encryption

    classDef monitorNode fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef alertNode fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef errorNode fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef securityNode fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef collectNode fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px

    class System_Mon,App_Mon,Business_Mon,Log_Mon monitorNode
    class Alert_Rule,Alert_Channel,Alert_History alertNode
    class Error_Handler,Error_Recovery,Error_Track,Error_Report errorNode
    class Auth,Access_Control,Threat_Detect,Rate_Limit,Encryption securityNode
    class Metrics_Collect,Log_Collect,Event_Collect collectNode
```

## éƒ¨ç½²æ¶æ„å›¾

```mermaid
graph TB
    subgraph "å¼€å‘ç¯å¢ƒ Development"
        DEV_MAC[macOSå¼€å‘ç¯å¢ƒ<br/>Python 3.10<br/>ä»£ç å¼€å‘]
    end

    subgraph "æµ‹è¯•ç¯å¢ƒ Testing"
        TEST_WIN[Windowsæµ‹è¯•ç¯å¢ƒ<br/>CUDA GPU<br/>æ€§èƒ½æµ‹è¯•]
    end

    subgraph "ç”Ÿäº§ç¯å¢ƒ Production"
        PROD_LINUX[Linuxç”Ÿäº§ç¯å¢ƒ<br/>çº¯å†…ç½‘éƒ¨ç½²]

        subgraph "å®¹å™¨åŒ–éƒ¨ç½²"
            DOCKER[Dockerå®¹å™¨]
            COMPOSE[Docker Compose]
        end

        subgraph "æœåŠ¡ç»„ä»¶"
            API_SVC[FastAPIæœåŠ¡]
            DETECT_SVC[æ£€æµ‹æœåŠ¡]
            WS_SVC[WebSocketæœåŠ¡]
            NGINX[Nginxåå‘ä»£ç†]
        end

        subgraph "æ•°æ®å­˜å‚¨"
            DB_PROD[(SQLiteæ•°æ®åº“)]
            FILES_PROD[è§†é¢‘/å›¾ç‰‡å­˜å‚¨]
            CACHE_PROD[ç¼“å­˜ç³»ç»Ÿ]
        end
    end

    subgraph "ç›‘æ§è¿ç»´"
        MON_PROD[ç›‘æ§ç³»ç»Ÿ<br/>Prometheus/Grafana]
        LOG_PROD[æ—¥å¿—ç³»ç»Ÿ<br/>ELK Stack]
        ALERT_PROD[å‘Šè­¦ç³»ç»Ÿ]
    end

    DEV_MAC -->|Gitæ¨é€| TEST_WIN
    TEST_WIN -->|éªŒè¯é€šè¿‡| PROD_LINUX

    PROD_LINUX --> DOCKER
    DOCKER --> COMPOSE
    COMPOSE --> API_SVC
    COMPOSE --> DETECT_SVC
    COMPOSE --> WS_SVC
    COMPOSE --> NGINX

    API_SVC --> DB_PROD
    DETECT_SVC --> FILES_PROD
    WS_SVC --> CACHE_PROD

    API_SVC --> MON_PROD
    DETECT_SVC --> LOG_PROD
    MON_PROD --> ALERT_PROD

    classDef devEnv fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef testEnv fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef prodEnv fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    classDef containerLayer fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    classDef serviceLayer fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef storageLayer fill:#efebe9,stroke:#4e342e,stroke-width:2px
    classDef monitorLayer fill:#e0f2f1,stroke:#00695c,stroke-width:2px

    class DEV_MAC devEnv
    class TEST_WIN testEnv
    class PROD_LINUX prodEnv
    class DOCKER,COMPOSE containerLayer
    class API_SVC,DETECT_SVC,WS_SVC,NGINX serviceLayer
    class DB_PROD,FILES_PROD,CACHE_PROD storageLayer
    class MON_PROD,LOG_PROD,ALERT_PROD monitorLayer
```

## æŠ€æœ¯æ ˆå›¾

```mermaid
mindmap
  root((äººä½“è¡Œä¸ºæ£€æµ‹ç³»ç»Ÿ))
    åç«¯æ¡†æ¶
      FastAPI
      Uvicorn
      Pydantic
    æ·±åº¦å­¦ä¹ 
      PyTorch
      Ultralytics YOLOv8
      MediaPipe
      XGBoost
    è®¡ç®—åŠ é€Ÿ
      CUDA
      TensorRT
      MPS Apple Silicon
      æ··åˆç²¾åº¦è®­ç»ƒ
    WebæŠ€æœ¯
      WebSocket
      RESTful API
      CORS
      JWTè®¤è¯
    æ•°æ®å­˜å‚¨
      SQLite
      æ–‡ä»¶ç³»ç»Ÿ
      Redisç¼“å­˜
    ç›‘æ§è¿ç»´
      Prometheus
      Grafana
      ELK Stack
      ç»“æ„åŒ–æ—¥å¿—
    å®‰å…¨é˜²æŠ¤
      RBACè®¿é—®æ§åˆ¶
      åŠ å¯†ç³»ç»Ÿ
      å¨èƒæ£€æµ‹
      é€Ÿç‡é™åˆ¶
    æ¶æ„æ¨¡å¼
      ä¾èµ–æ³¨å…¥
      äº‹ä»¶é©±åŠ¨
      æ’ä»¶ç³»ç»Ÿ
      å¾®æœåŠ¡
    æ€§èƒ½ä¼˜åŒ–
      GPUåŠ é€Ÿ
      æ‰¹å¤„ç†
      å¼‚æ­¥å¤„ç†
      ç¼“å­˜ç­–ç•¥
    å¼€å‘å·¥å…·
      Git
      Pre-commit Hooks
      Black Formatter
      MyPyç±»å‹æ£€æŸ¥
```

---

## æ¶æ„ç‰¹ç‚¹è¯´æ˜

### 1. **åˆ†å±‚æ¶æ„**
- **ç”¨æˆ·å±‚**: Webå‰ç«¯ã€CLIã€APIå®¢æˆ·ç«¯
- **æ¥å£å±‚**: FastAPI + ä¸­é—´ä»¶ + è·¯ç”±
- **æœåŠ¡å±‚**: ä¸šåŠ¡é€»è¾‘æœåŠ¡
- **æ ¸å¿ƒå±‚**: æ£€æµ‹ç®¡çº¿å’Œæ ¸å¿ƒç»„ä»¶
- **æ£€æµ‹å™¨å±‚**: å„ç±»AIæ£€æµ‹å™¨
- **å·¥å…·å±‚**: é€šç”¨å·¥å…·å’Œä¼˜åŒ–ç»„ä»¶

### 2. **æ ¸å¿ƒä¼˜åŠ¿**
- âœ… **é«˜æ€§èƒ½**: GPUåŠ é€Ÿã€æ‰¹å¤„ç†ã€å¼‚æ­¥å¤„ç†
- âœ… **é«˜å¯ç”¨**: é”™è¯¯å¤„ç†ã€ç›‘æ§å‘Šè­¦ã€è‡ªåŠ¨æ¢å¤
- âœ… **é«˜å®‰å…¨**: èº«ä»½è®¤è¯ã€è®¿é—®æ§åˆ¶ã€å¨èƒæ£€æµ‹
- âœ… **æ˜“æ‰©å±•**: ä¾èµ–æ³¨å…¥ã€äº‹ä»¶é©±åŠ¨ã€æ’ä»¶ç³»ç»Ÿ
- âœ… **æ˜“ç»´æŠ¤**: ç»“æ„åŒ–æ—¥å¿—ã€ç›‘æ§ç³»ç»Ÿã€æ¶æ„åˆ†æ

### 3. **æŠ€æœ¯åˆ›æ–°**
- ğŸš€ **è‡ªé€‚åº”ä¼˜åŒ–**: æ ¹æ®ç¡¬ä»¶è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜é…ç½®
- ğŸš€ **å¤šåç«¯æ”¯æŒ**: MediaPipeã€YOLOv8å§¿æ€æ£€æµ‹
- ğŸš€ **ä¼ä¸šçº§ç›‘æ§**: å¤šç»´åº¦æŒ‡æ ‡ã€å®æ—¶å‘Šè­¦
- ğŸš€ **ç°ä»£åŒ–æ¶æ„**: DIã€äº‹ä»¶ç³»ç»Ÿã€æ’ä»¶åŒ–

### 4. **éƒ¨ç½²æ–¹å¼**
- ğŸ“¦ **å®¹å™¨åŒ–**: Docker + Docker Compose
- ğŸ“¦ **å¤šç¯å¢ƒ**: å¼€å‘(macOS) â†’ æµ‹è¯•(Windows GPU) â†’ ç”Ÿäº§(Linux)
- ğŸ“¦ **çº¯å†…ç½‘**: æ”¯æŒå†…ç½‘ç¯å¢ƒéƒ¨ç½²
