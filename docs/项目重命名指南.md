# 项目根目录重命名指南

## 📋 概述

本文档说明如何将项目根目录从 `Pyt` 重命名为其他名称，以及需要修改的文件清单。

## ⚠️ 重要说明

### 命名空间区分

项目中有两套不同的命名体系，**互不影响**：

1. **`pepgmp`** - Docker/容器命名（**不需要修改**）
   - Docker 镜像名称：`pepgmp-backend`, `pepgmp-frontend`
   - Docker 容器名称：`pepgmp-postgres-prod`, `pepgmp-api-prod` 等
   - 数据库名称：`pepgmp_production`, `pepgmp_prod`
   - **这些名称保持不变，与根目录名称无关**

2. **`Pyt`** - 文件系统路径（**本次需要修改**）
   - 项目根目录名称：`/Users/zhou/Code/Pyt`
   - 部署目录默认路径：`~/projects/PEPGMP, `~/projects/PEPGMP-deploy`
   - 脚本中的默认路径参数
   - **这些路径需要更新为新目录名**

**重命名根目录不会影响 Docker 容器、镜像或数据库的命名。**

---

## 🔍 影响范围

### ✅ 不受影响的部分

以下部分**不需要修改**，因为它们使用动态路径或相对路径：

1. **脚本中的 PROJECT_ROOT**：
   - 大部分脚本使用 `PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"` 动态获取
   - 这些脚本会自动适应新的目录名

2. **Docker 配置**：
   - `docker-compose.yml` 等配置文件使用相对路径
   - 容器内的路径不依赖外部目录名

3. **代码中的路径**：
   - Python 代码使用相对路径或环境变量
   - 配置文件使用相对路径

### ⚠️ 需要修改的部分

以下文件包含硬编码的路径，需要手动修改：

---

## 📝 需要修改的文件清单

### 1. 脚本文件（Scripts）

#### 1.1 部署相关脚本

**文件**: `scripts/prepare_minimal_deploy.sh`
- **行 11**: `DEPLOY_DIR="${1:-$HOME/projects/Pyt}"`
- **修改为**: `DEPLOY_DIR="${1:-$HOME/projects/<新名称>}"`

**文件**: `scripts/deploy_prod_wsl.sh`
- **行 20**: `DEPLOY_DIR="${1:-$HOME/projects/Pyt-deploy}"`
- **修改为**: `DEPLOY_DIR="${1:-$HOME/projects/<新名称>-deploy}"`

**文件**: `scripts/deploy_prod_macos.sh`
- **行 23**: `DEPLOY_DIR="${1:-$HOME/projects/Pyt}"`
- **修改为**: `DEPLOY_DIR="${1:-$HOME/projects/<新名称>}"`

**文件**: `scripts/update_deployment_wsl.sh`
- **行 20**: `DEPLOY_DIR="${1:-$HOME/projects/Pyt-deploy}"`
- **行 73-74**: Windows 路径检测
  ```bash
  if [ -d "/mnt/c" ] && [ -f "/mnt/c/Users/YourName/Code/PEPGMP/docker-compose.prod.yml" ]; then
      WINDOWS_PROJECT="/mnt/c/Users/YourName/Code/PEPGMP"
  ```
- **修改为**: 将 `Pyt` 替换为 `<新名称>`

**文件**: `scripts/sync_code_to_wsl.sh`
- **行 31**: `SOURCE_PATH="${1:-/mnt/c/Users/YourName/Code/PEPGMP}"`
- **行 32**: `TARGET_PATH="${2:-$HOME/projects/Pyt}"`
- **行 47**: 示例路径
- **修改为**: 将所有 `Pyt` 替换为 `<新名称>`

**文件**: `scripts/deploy_to_wsl2.sh`
- **行 22**: `DEPLOY_DIR="${3:-~/projects/PEPGMP"`
- **行 109**: `DEPLOY_PACKAGE_DIR="$PROJECT_ROOT/deploy-packages/Pyt-$VERSION_TAG"`
- **修改为**: 将 `Pyt` 替换为 `<新名称>`

**文件**: `scripts/prepare_deployment_package.sh`
- **行 92**: `DEPLOY_PACKAGE_DIR="$PROJECT_ROOT/deploy-packages/Pyt-$VERSION_TAG"`
- **行 165-166**: 示例路径
- **修改为**: 将 `Pyt` 替换为 `<新名称>`

**文件**: `scripts/verify_deployment_macos.sh`
- **行 19**: `DEPLOY_DIR="${1:-$HOME/projects/Pyt}"`
- **修改为**: `DEPLOY_DIR="${1:-$HOME/projects/<新名称>}"`

**文件**: `scripts/verify_deployment_remote.sh`
- **行 20**: `DEPLOY_DIR="${2:-$HOME/projects/Pyt}"`
- **行 38**: 示例路径
- **修改为**: 将 `Pyt` 替换为 `<新名称>`

**文件**: `scripts/diagnose_frontend_whitescreen.sh`
- **行 19**: `DEPLOY_DIR="${1:-$HOME/projects/Pyt}"`
- **修改为**: `DEPLOY_DIR="${1:-$HOME/projects/<新名称>}"`

#### 1.2 其他脚本

**文件**: `scripts/import_images_from_windows.sh`
- **行 42**: `WINDOWS_PROJECT_PATH="/mnt/f/code/PythonCode/Pyt"`
- **行 155, 160**: 示例路径
- **修改为**: 将 `Pyt` 替换为 `<新名称>`

**文件**: `scripts/export_images_to_wsl.ps1`
- **行 123**: `$WSL_PROJECT_PATH = "/mnt/f/code/PythonCode/Pyt"`
- **行 143**: 示例路径
- **修改为**: 将 `Pyt` 替换为 `<新名称>`

**文件**: `scripts/mlops/train_hairnet_workflow.py`
- **行 227-228**: 硬编码的 macOS 路径
  ```python
  dataset_path = "/Users/zhou/Code/Pyt/data/datasets/hairnet.v15i.yolov8"
  data_yaml_path = "/Users/zhou/Code/Pyt/data/datasets/hairnet.v15i.yolov8/data.yaml"
  ```
- **修改为**: 使用相对路径或环境变量

---

### 2. 文档文件（Documentation）

以下文档包含示例路径，建议更新以保持一致性：

**文件**: `docs/WSL一键部署和快速更新指南.md`
- 所有 `~/projects/PEPGMP 和 `~/projects/PEPGMP-deploy` 的引用

**文件**: `docs/WSL直接构建部署指南.md`
- 所有 `~/projects/PEPGMP 和 `/mnt/c/Users/YourName/Code/PEPGMP` 的引用

**文件**: `docs/容器名称冲突问题解决.md`
- 所有 `~/projects/PEPGMP 和 `~/projects/PEPGMP-deploy` 的引用

**文件**: `scripts/README.md`
- **行 142**: 示例路径

**文件**: `scripts/mlops/quick_start_training.md`
- **行 38-39, 102-103**: 硬编码路径

**文件**: `scripts/mlops/README.md`
- **行 11**: 硬编码路径

---

## 🔧 重命名步骤

### 步骤 1: 备份当前项目

```bash
# 在项目父目录
cp -r Pyt Pyt.backup
```

### 步骤 2: 重命名目录

```bash
# 在项目父目录
mv Pyt <新名称>
cd <新名称>
```

### 步骤 3: 修改脚本文件

使用以下命令批量替换（**请先备份**）：

```bash
# 在项目根目录执行
# 替换脚本中的默认路径
find scripts/ -type f -name "*.sh" -exec sed -i.bak 's|~/projects/PEPGMP~/projects/<新名称>|g' {} \;
find scripts/ -type f -name "*.sh" -exec sed -i.bak 's|/mnt/c/Users/YourName/Code/PEPGMP|/mnt/c/Users/$USER/Code/<新名称>|g' {} \;
find scripts/ -type f -name "*.sh" -exec sed -i.bak 's|$HOME/projects/Pyt|$HOME/projects/<新名称>|g' {} \;

# 替换 Python 脚本中的硬编码路径
find scripts/ -type f -name "*.py" -exec sed -i.bak 's|/Users/zhou/Code/Pyt|/Users/zhou/Code/<新名称>|g' {} \;

# 替换 PowerShell 脚本
find scripts/ -type f -name "*.ps1" -exec sed -i.bak 's|/mnt/f/code/PythonCode/Pyt|/mnt/f/code/PythonCode/<新名称>|g' {} \;

# 清理备份文件
find scripts/ -name "*.bak" -delete
```

### 步骤 4: 更新文档（可选）

```bash
# 更新文档中的示例路径
find docs/ -type f -name "*.md" -exec sed -i.bak 's|~/projects/PEPGMP~/projects/<新名称>|g' {} \;
find docs/ -type f -name "*.md" -exec sed -i.bak 's|~/projects/PEPGMP-deploy|~/projects/<新名称>-deploy|g' {} \;
find docs/ -name "*.bak" -delete
```

### 步骤 5: 验证修改

```bash
# 检查是否还有遗漏的引用
grep -r "Pyt" scripts/ --exclude-dir=.git
grep -r "Pyt" docs/ --exclude-dir=.git

# 测试关键脚本
bash scripts/prepare_minimal_deploy.sh --help
```

### 步骤 6: 更新 Git 远程仓库（如需要）

如果 Git 仓库名称也要更改：

```bash
# 查看当前远程仓库
git remote -v

# 如果仓库名称也要改，需要：
# 1. 在 Git 平台（GitHub/GitLab）上重命名仓库
# 2. 更新本地远程 URL
git remote set-url origin <新的仓库URL>
```

---

## ⚠️ 注意事项

1. **部署目录**: 如果已有部署目录 `~/projects/PEPGMP-deploy`，需要手动重命名或更新脚本中的路径

2. **环境变量**: 检查是否有环境变量引用了旧路径

3. **IDE 配置**: 如果使用 IDE（如 PyCharm、VSCode），可能需要更新项目路径配置

4. **Docker 卷挂载**: 如果 Docker Compose 中有卷挂载使用绝对路径，需要检查并更新

5. **CI/CD 配置**: 如果有 CI/CD 配置（如 GitHub Actions），需要更新相关路径

6. **备份策略**: 确保备份脚本中的路径也已更新

---

## 📊 修改统计

预计需要修改：
- **脚本文件**: 约 12 个文件
- **文档文件**: 约 6 个文件
- **总修改行数**: 约 50-80 行

---

## ✅ 验证清单

重命名完成后，请验证：

- [ ] 所有脚本中的默认路径已更新
- [ ] 文档中的示例路径已更新（可选）
- [ ] 测试关键部署脚本是否正常工作
- [ ] 检查是否有遗漏的硬编码路径
- [ ] 更新 IDE 项目配置（如需要）
- [ ] 更新 CI/CD 配置（如需要）

---

## 🔄 回滚方案

如果重命名后出现问题，可以：

```bash
# 恢复目录名
cd ..
mv <新名称> Pyt

# 恢复脚本文件（如果有备份）
cd Pyt
git checkout scripts/
```

---

## 📚 相关文档

- [部署脚本说明](scripts/README.md)
- [WSL 部署指南](docs/WSL一键部署和快速更新指南.md)
