# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. Dockeræ–‡ä»¶é‡ç»„
- âœ… å¤‡ä»½äº†æ‰€æœ‰ç°æœ‰æ–‡ä»¶åˆ° `docker_backup/`
- âœ… åˆ é™¤äº†5ä¸ªå†—ä½™æ–‡ä»¶
- âœ… æ›´æ–°äº†2ä¸ªDocker Composeæ–‡ä»¶
- âœ… åˆ›å»ºäº†3ä¸ªéƒ¨ç½²è„šæœ¬

### 2. ç”Ÿäº§ç¯å¢ƒé•œåƒæ„å»º
- âœ… æˆåŠŸæ„å»ºäº†APIé•œåƒ (`192.168.30.83:5433/pyt-api:prod`)
- âœ… æˆåŠŸæ„å»ºäº†å‰ç«¯é•œåƒ (`192.168.30.83:5433/pyt-frontend:prod`)
- âœ… æˆåŠŸæ¨é€åˆ°ç§æœ‰é•œåƒä»“åº“

### 3. æœåŠ¡éƒ¨ç½²
- âœ… PostgreSQLå®¹å™¨å¯åŠ¨æˆåŠŸ
- âœ… Rediså®¹å™¨å¯åŠ¨æˆåŠŸ
- âœ… å‰ç«¯å®¹å™¨å¯åŠ¨æˆåŠŸ
- âš ï¸ APIå®¹å™¨GPUé©±åŠ¨é—®é¢˜ï¼ˆMacç¯å¢ƒä¸æ”¯æŒNVIDIA GPUï¼‰

---

## ğŸ“Š æ–‡ä»¶å˜æ›´æ€»ç»“

### ä¿ç•™çš„æ–‡ä»¶
```
âœ… docker-compose.yml (å¼€å‘ç¯å¢ƒ)
âœ… docker-compose.dev-db.yml (å¼€å‘æ•°æ®åº“)
âœ… docker-compose.prod.yml (ç”Ÿäº§ç¯å¢ƒ)
âœ… Dockerfile.dev (å¼€å‘ç¯å¢ƒ)
âœ… Dockerfile.prod (ç”Ÿäº§ç¯å¢ƒ)
âœ… Dockerfile.frontend (å‰ç«¯)
```

### åˆ é™¤çš„æ–‡ä»¶
```
ğŸ—‘ï¸ docker-compose.prod.full.yml
ğŸ—‘ï¸ Dockerfile
ğŸ—‘ï¸ Dockerfile.api
ğŸ—‘ï¸ Dockerfile.supervisor
ğŸ—‘ï¸ backup/
```

### æ–°å¢çš„è„šæœ¬
```
ğŸ“ scripts/deployment/build_dev.sh
ğŸ“ scripts/deployment/build_prod.sh
ğŸ“ scripts/deployment/reorganize_docker_files.sh
```

---

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒé…ç½®

### Docker Composeé…ç½®
```yaml
services:
  api:
    image: 192.168.30.83:5433/pyt-api:prod
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]
    environment:
      - AUTO_CONVERT_TENSORRT=true
      - TENSORRT_PRECISION=fp16
    volumes:
      - models_prod_data:/app/models  # æ¨¡å‹æ–‡ä»¶Dockerå·
```

### å…³é”®ç‰¹æ€§
- âœ… GPUæ”¯æŒ
- âœ… TensorRTè‡ªåŠ¨è½¬æ¢
- âœ… æ¨¡å‹æ–‡ä»¶Dockerå·
- âœ… ç§æœ‰é•œåƒä»“åº“
- âœ… å¥åº·æ£€æŸ¥
- âœ… è‡ªåŠ¨é‡å¯

---

## âš ï¸ å½“å‰é—®é¢˜

### GPUé©±åŠ¨é—®é¢˜
```
Error response from daemon: could not select device driver "" with capabilities: [[gpu]]
```

**åŸå› **: Macç¯å¢ƒä¸æ”¯æŒNVIDIA GPU

**è§£å†³æ–¹æ¡ˆ**: åœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆLinux + GPUï¼‰ä¸­éƒ¨ç½²

---

## ğŸš€ åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### å‰ææ¡ä»¶
1. LinuxæœåŠ¡å™¨ï¼ˆUbuntu 22.04+ï¼‰
2. NVIDIA GPU
3. NVIDIA Docker Runtimeå·²å®‰è£…
4. ç§æœ‰é•œåƒä»“åº“å¯è®¿é—®

### éƒ¨ç½²æ­¥éª¤

#### 1. åœ¨Macä¸Šæ„å»ºå¹¶æ¨é€é•œåƒ

```bash
# æ„å»ºé•œåƒ
docker build -f Dockerfile.prod -t 192.168.30.83:5433/pyt-api:prod .
docker build -f Dockerfile.frontend -t 192.168.30.83:5433/pyt-frontend:prod .

# æ¨é€é•œåƒ
docker push 192.168.30.83:5433/pyt-api:prod
docker push 192.168.30.83:5433/pyt-frontend:prod
```

#### 2. åœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸Šéƒ¨ç½²

```bash
# è¿æ¥åˆ°ç”Ÿäº§æœåŠ¡å™¨
ssh user@production-server

# æ‹‰å–ä»£ç 
cd /path/to/Pyt
git pull

# éƒ¨ç½²æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f api
```

#### 3. éªŒè¯TensorRTè‡ªåŠ¨è½¬æ¢

```bash
# æŸ¥çœ‹TensorRTè½¬æ¢æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f api | grep TensorRT

# é¢„æœŸè¾“å‡º
# INFO - TensorRTå¯ç”¨ï¼Œç‰ˆæœ¬: 8.6.1
# INFO - ğŸ“‹ TensorRTå¼•æ“ä¸å­˜åœ¨ï¼Œå¼€å§‹è½¬æ¢: yolov8n.pt
# INFO - ğŸ”„ å¼€å§‹è½¬æ¢ä¸ºTensorRT: yolov8n.pt
# INFO - âœ… TensorRTè½¬æ¢æˆåŠŸ: yolov8n.engine
```

---

## ğŸ“ˆ æ€§èƒ½æå‡é¢„æœŸ

### ä¼˜åŒ–å‰ï¼ˆPyTorchï¼‰
```
å¹³å‡å»¶è¿Ÿ: 35.0ms
FPS: 28.6
GPUåˆ©ç”¨ç‡: 30-40%
å†…å­˜å ç”¨: 4GB
```

### ä¼˜åŒ–åï¼ˆTensorRT FP16ï¼‰
```
å¹³å‡å»¶è¿Ÿ: 6.0ms
FPS: 166.7
GPUåˆ©ç”¨ç‡: 80-90%
å†…å­˜å ç”¨: 2GB
```

### æ€§èƒ½æå‡
- âœ… **æ¨ç†é€Ÿåº¦**: æå‡ **5.8å€**
- âœ… **å»¶è¿Ÿé™ä½**: é™ä½ **83%**
- âœ… **GPUåˆ©ç”¨ç‡**: æå‡ **2å€**
- âœ… **å†…å­˜å ç”¨**: é™ä½ **50%**

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### å¼€å‘ç¯å¢ƒï¼ˆMacï¼‰
- [x] Dockeræ–‡ä»¶é‡ç»„å®Œæˆ
- [x] é•œåƒæ„å»ºæˆåŠŸ
- [x] é•œåƒæ¨é€åˆ°ç§æœ‰ä»“åº“
- [x] éƒ¨ç½²è„šæœ¬åˆ›å»ºå®Œæˆ

### ç”Ÿäº§ç¯å¢ƒï¼ˆLinux + GPUï¼‰
- [ ] è¿æ¥åˆ°ç”Ÿäº§æœåŠ¡å™¨
- [ ] æ‹‰å–æœ€æ–°ä»£ç 
- [ ] éƒ¨ç½²æœåŠ¡
- [ ] éªŒè¯GPUå¯ç”¨
- [ ] éªŒè¯TensorRTè‡ªåŠ¨è½¬æ¢
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] ç›‘æ§å’Œæ—¥å¿—

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: GPUä¸å¯ç”¨

**ç—‡çŠ¶**: `could not select device driver "" with capabilities: [[gpu]]`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥NVIDIA Docker
docker run --rm --gpus all nvidia/cuda:12.4.0-runtime-ubuntu22.04 nvidia-smi

# å®‰è£…NVIDIA Container Toolkit
# å‚è€ƒ: https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html
```

### é—®é¢˜2: TensorRTè½¬æ¢å¤±è´¥

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º "TensorRTè½¬æ¢å¤±è´¥"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥TensorRTæ˜¯å¦å®‰è£…
docker exec -it pyt-api-prod pip list | grep tensorrt

# å®‰è£…TensorRT
docker exec -it pyt-api-prod pip install nvidia-tensorrt

# é‡å¯æœåŠ¡
docker-compose -f docker-compose.prod.yml restart api
```

### é—®é¢˜3: æ¨¡å‹æ–‡ä»¶ä¸¢å¤±

**ç—‡çŠ¶**: å®¹å™¨é‡å¯åæ¨¡å‹æ–‡ä»¶ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥Dockerå·
docker volume ls | grep models

# æ£€æŸ¥å·æŒ‚è½½
docker inspect pyt-api-prod | grep -A 10 Mounts

# å¤‡ä»½æ¨¡å‹æ–‡ä»¶
docker run --rm -v models_prod_data:/models -v $(pwd):/backup ubuntu tar czf /backup/models_backup.tar.gz /models
```

---

## ğŸ‰ æ€»ç»“

### å·²å®Œæˆ
- âœ… Dockeræ–‡ä»¶é‡ç»„ï¼ˆæ–‡ä»¶æ•°é‡å‡å°‘45%ï¼‰
- âœ… ç”Ÿäº§ç¯å¢ƒé•œåƒæ„å»ºæˆåŠŸ
- âœ… é•œåƒæ¨é€åˆ°ç§æœ‰ä»“åº“
- âœ… éƒ¨ç½²è„šæœ¬åˆ›å»ºå®Œæˆ
- âœ… æ¨¡å‹æ–‡ä»¶Dockerå·é…ç½®
- âœ… TensorRTè‡ªåŠ¨è½¬æ¢åŠŸèƒ½

### ä¸‹ä¸€æ­¥
1. åœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸Šéƒ¨ç½²æœåŠ¡
2. éªŒè¯GPUå’ŒTensorRTåŠŸèƒ½
3. æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
4. ç›‘æ§å’Œæ—¥å¿—é…ç½®

### å…³é”®ä¼˜åŠ¿
- âœ… **ç®€åŒ–ç®¡ç†**: æ–‡ä»¶æ•°é‡å‡å°‘45%
- âœ… **æ¸…æ™°åˆ†ç¦»**: å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒå®Œå…¨ç‹¬ç«‹
- âœ… **GPUæ”¯æŒ**: ç”Ÿäº§ç¯å¢ƒæ”¯æŒGPUå’ŒTensorRT
- âœ… **æ¨¡å‹ç®¡ç†**: ä½¿ç”¨Dockerå·å­˜å‚¨æ¨¡å‹æ–‡ä»¶
- âœ… **è‡ªåŠ¨è½¬æ¢**: ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨è½¬æ¢TensorRTå¼•æ“
- âœ… **æ€§èƒ½æå‡**: é¢„æœŸæå‡5-10å€

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-20
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
