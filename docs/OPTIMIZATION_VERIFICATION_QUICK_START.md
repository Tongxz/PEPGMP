# ä¼˜åŒ–åŠŸèƒ½éªŒè¯å¿«é€ŸæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ£€æŸ¥ä¼˜åŒ–åŠŸèƒ½çŠ¶æ€

#### æ–¹æ³•1: ä½¿ç”¨APIç«¯ç‚¹ï¼ˆæ¨èï¼‰

å¯åŠ¨åç«¯æœåŠ¡åï¼Œè®¿é—®ä»¥ä¸‹ç«¯ç‚¹æŸ¥çœ‹ä¼˜åŒ–åŠŸèƒ½çŠ¶æ€ï¼š

```bash
curl http://localhost:8000/api/v1/detect/stats
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "optimization_enabled": true,
  "state_management": {
    "enabled": true,
    "stats": {
      "total_tracks": 10,
      "stable_states": 8,
      "violations": 2
    }
  },
  "async_detection": {
    "enabled": false,
    "max_workers": 0
  },
  "cache": {
    "enabled": true,
    "stats": {
      "cache_size": 50,
      "max_size": 100,
      "ttl": 30.0
    },
    "hit_rate": 0.67
  },
  "performance": {
    "total_detections": 150,
    "avg_processing_time": 0.15,
    "cache_hits": 100,
    "cache_misses": 50
  },
  "roi_optimization": {
    "enabled": true
  },
  "frame_skip": {
    "enabled": false
  }
}
```

#### æ–¹æ³•2: æŸ¥çœ‹åç«¯æ—¥å¿—

å¯åŠ¨åç«¯æœåŠ¡åï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
çŠ¶æ€ç®¡ç†å·²å¯ç”¨
ä¼˜åŒ–æ£€æµ‹ç®¡é“åˆå§‹åŒ–å®Œæˆï¼Œç¼“å­˜: å¯ç”¨
```

### 2. æµ‹è¯•æ£€æµ‹æ¥å£

#### ä½¿ç”¨ curl æµ‹è¯•

```bash
# æµ‹è¯•ç»¼åˆæ£€æµ‹æ¥å£
curl -X POST "http://localhost:8000/api/v1/detect/comprehensive?camera_id=test_camera" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@test_image.jpg"
```

#### ä½¿ç”¨å‰ç«¯ç•Œé¢

1. æ‰“å¼€å‰ç«¯ç•Œé¢
2. ä¸Šä¼ ä¸€å¼ æµ‹è¯•å›¾ç‰‡
3. æŸ¥çœ‹æ£€æµ‹ç»“æœ
4. æ£€æŸ¥ `processing_times` å­—æ®µï¼ŒæŸ¥çœ‹å„é˜¶æ®µå¤„ç†æ—¶é—´

### 3. è¿è¡ŒéªŒè¯è„šæœ¬

```bash
# è¿è¡ŒéªŒè¯è„šæœ¬ï¼ˆéœ€è¦æä¾›æµ‹è¯•å›¾åƒï¼‰
python scripts/verification/verify_optimizations.py --image tests/fixtures/images/test_image.jpg --iterations 5
```

**è¾“å‡ºç¤ºä¾‹**:
```
=== æ£€æŸ¥ä¼˜åŒ–åŠŸèƒ½çŠ¶æ€ ===
âœ… FrameMetadata å¯ç”¨
âœ… çŠ¶æ€ç®¡ç†å·²å¯ç”¨
â„¹ï¸  å¼‚æ­¥æ£€æµ‹æœªå¯ç”¨ï¼ˆé»˜è®¤ç¦ç”¨ï¼‰
âœ… ç¼“å­˜å·²å¯ç”¨
âœ… ROIä¼˜åŒ–å·²å¯ç”¨

=== æµ‹è¯•æ£€æµ‹æ€§èƒ½ ===
å¹³å‡æ£€æµ‹æ—¶é—´: 0.150s
æœ€çŸ­æ£€æµ‹æ—¶é—´: 0.120s
æœ€é•¿æ£€æµ‹æ—¶é—´: 0.180s

=== æµ‹è¯•ROIä¼˜åŒ– ===
æ£€æµ‹åˆ° 2 ä¸ªäºº
å‘ç½‘ROIæ£€æµ‹æ—¶é—´: 0.050s
å§¿æ€ROIæ£€æµ‹æ—¶é—´: 0.080s

=== æµ‹è¯•ç¼“å­˜æ€§èƒ½ ===
ç¬¬ä¸€æ¬¡æ£€æµ‹æ—¶é—´: 0.150s
å¹³å‡ç¼“å­˜æ—¶é—´: 0.010s
åŠ é€Ÿæ¯”: 15.00x
ç¼“å­˜å‘½ä¸­ç‡: 90.00%
```

## ğŸ“Š éªŒè¯ checklist

- [ ] **çŠ¶æ€ç®¡ç†å·²å¯ç”¨**: `state_management.enabled = true`
- [ ] **ç¼“å­˜å·²å¯ç”¨**: `cache.enabled = true`
- [ ] **ROIä¼˜åŒ–å·²å¯ç”¨**: `roi_optimization.enabled = true`
- [ ] **æ£€æµ‹æ€§èƒ½æ­£å¸¸**: å¹³å‡æ£€æµ‹æ—¶é—´ < 200ms
- [ ] **ç¼“å­˜å‘½ä¸­ç‡æ­£å¸¸**: ç¼“å­˜å‘½ä¸­ç‡ > 50%ï¼ˆè§†é¢‘æµåœºæ™¯ï¼‰
- [ ] **APIå“åº”æ­£å¸¸**: æ£€æµ‹æ¥å£è¿”å›æ­£ç¡®ç»“æœ
- [ ] **æ—¥å¿—è¾“å‡ºæ­£å¸¸**: æ²¡æœ‰é”™è¯¯æˆ–è­¦å‘Š

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜1: çŠ¶æ€ç®¡ç†æœªå¯ç”¨

**ç—‡çŠ¶**: `state_management.enabled = false`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `src/core/frame_metadata.py` æ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. é‡å¯åç«¯æœåŠ¡

### é—®é¢˜2: ç¼“å­˜æœªç”Ÿæ•ˆ

**ç—‡çŠ¶**: `cache.hit_rate = 0` æˆ– `cache.stats.cache_size = 0`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `cache.enabled = true`
2. å¤šæ¬¡è¯·æ±‚ç›¸åŒçš„å›¾åƒï¼ŒæŸ¥çœ‹ç¼“å­˜å‘½ä¸­ç‡æ˜¯å¦æå‡
3. æ£€æŸ¥ `cache.stats.cache_size` æ˜¯å¦å¢é•¿

### é—®é¢˜3: ROIä¼˜åŒ–æœªç”Ÿæ•ˆ

**ç—‡çŠ¶**: `roi_optimization.enabled = false`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `_detect_hairnet_for_persons` æ–¹æ³•æ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥æ£€æµ‹ç»“æœä¸­æ˜¯å¦åŒ…å« `person_detections`
3. æŸ¥çœ‹åç«¯æ—¥å¿—æ˜¯å¦æœ‰ç›¸å…³é”™è¯¯

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æ€§èƒ½ç›‘æ§**: æŒç»­ç›‘æ§æ£€æµ‹æ€§èƒ½å’Œç¼“å­˜å‘½ä¸­ç‡
2. **ä¼˜åŒ–è°ƒæ•´**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´é…ç½®å‚æ•°
3. **ç”Ÿäº§éªŒè¯**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éªŒè¯ä¼˜åŒ–åŠŸèƒ½
4. **ç”¨æˆ·åé¦ˆ**: æ”¶é›†ç”¨æˆ·åé¦ˆï¼ŒæŒç»­æ”¹è¿›

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [ä¼˜åŒ–åŠŸèƒ½éªŒè¯æŒ‡å—](./OPTIMIZATION_VERIFICATION_GUIDE.md)
- [ä¼˜åŒ–å®æ–½è®¡åˆ’](./OPTIMIZATION_IMPLEMENTATION_PLAN.md)
- [ç³»ç»Ÿæ¶æ„æ–‡æ¡£](./SYSTEM_ARCHITECTURE.md)

