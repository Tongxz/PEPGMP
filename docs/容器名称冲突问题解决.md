# å®¹å™¨åç§°å†²çªé—®é¢˜è§£å†³

## ğŸ“‹ é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error response from daemon: Conflict. The container name "/pepgmp-postgres-prod" is already in use by container "..."
```

**åŸå› **ï¼š
- ä¹‹å‰éƒ¨ç½²çš„å®¹å™¨è¿˜åœ¨è¿è¡Œæˆ–å­˜åœ¨
- å¤šä¸ªéƒ¨ç½²ç›®å½•ä½¿ç”¨äº†ç›¸åŒçš„å®¹å™¨åç§°
- å®¹å™¨æœªæ­£ç¡®æ¸…ç†

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ³• 1: ä½¿ç”¨æ¸…ç†è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åœ¨ WSL ä¸­
cd ~/projects/PEPGMP-deploy

# è¿è¡Œæ¸…ç†è„šæœ¬
bash scripts/cleanup_old_containers.sh

# è„šæœ¬ä¼šï¼š
# 1. æŸ¥æ‰¾æ‰€æœ‰ pepgmp-* å®¹å™¨
# 2. æ˜¾ç¤ºå®¹å™¨çŠ¶æ€
# 3. è¯¢é—®ç¡®è®¤ååˆ é™¤
```

### æ–¹æ³• 2: æ‰‹åŠ¨æ¸…ç†

```bash
# åœæ­¢æ‰€æœ‰ç›¸å…³å®¹å™¨
docker stop pepgmp-postgres-prod \
  pepgmp-redis-prod \
  pepgmp-api-prod \
  pepgmp-nginx-prod \
  pepgmp-frontend-init 2>/dev/null || true

# åˆ é™¤æ‰€æœ‰ç›¸å…³å®¹å™¨
docker rm pepgmp-postgres-prod \
  pepgmp-redis-prod \
  pepgmp-api-prod \
  pepgmp-nginx-prod \
  pepgmp-frontend-init 2>/dev/null || true
```

### æ–¹æ³• 3: ä½¿ç”¨ Docker Compose æ¸…ç†

å¦‚æœçŸ¥é“ä¹‹å‰çš„éƒ¨ç½²ç›®å½•ï¼š

```bash
# è¿›å…¥ä¹‹å‰çš„éƒ¨ç½²ç›®å½•
cd ~/projects/PEPGMP # æˆ–å…¶ä»–éƒ¨ç½²ç›®å½•

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker compose -f docker-compose.prod.yml down

# æˆ–æŒ‡å®šç¯å¢ƒæ–‡ä»¶
docker compose -f docker-compose.prod.yml --env-file .env.production down
```

### æ–¹æ³• 4: ä¸€é”®æ¸…ç†ï¼ˆå¿«é€Ÿï¼‰

```bash
# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰ pepgmp-* å®¹å™¨
docker stop $(docker ps -aq --filter "name=pepgmp") 2>/dev/null || true
docker rm $(docker ps -aq --filter "name=pepgmp") 2>/dev/null || true
```

---

## ğŸ” æ£€æŸ¥æ­¥éª¤

### 1. æ£€æŸ¥ç°æœ‰å®¹å™¨

```bash
# æŸ¥çœ‹æ‰€æœ‰ç›¸å…³å®¹å™¨
docker ps -a | grep pepgmp

# æˆ–ä½¿ç”¨è¿‡æ»¤å™¨
docker ps -a --filter "name=pepgmp"
```

### 2. æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
# æŸ¥çœ‹ç‰¹å®šå®¹å™¨çŠ¶æ€
docker inspect pepgmp-postgres-prod --format='{{.State.Status}}'

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker ps -a --filter "name=pepgmp" --format "table {{.Names}}\t{{.Status}}"
```

### 3. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–éƒ¨ç½²ç›®å½•

```bash
# æŸ¥æ‰¾å…¶ä»–å¯èƒ½çš„éƒ¨ç½²ç›®å½•
find ~/projects -name "docker-compose.prod.yml" 2>/dev/null

# æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç›®å½•åœ¨ä½¿ç”¨ç›¸åŒå®¹å™¨
ls -la ~/projects/
```

---

## ğŸš€ å®Œæ•´æ¸…ç†å’Œé‡å¯æµç¨‹

```bash
# 1. æ£€æŸ¥ç°æœ‰å®¹å™¨
docker ps -a | grep pepgmp

# 2. æ¸…ç†æ—§å®¹å™¨
docker stop $(docker ps -aq --filter "name=pepgmp") 2>/dev/null || true
docker rm $(docker ps -aq --filter "name=pepgmp") 2>/dev/null || true

# 3. éªŒè¯æ¸…ç†
docker ps -a | grep pepgmp
# åº”è¯¥æ²¡æœ‰è¾“å‡º

# 4. é‡æ–°å¯åŠ¨
cd ~/projects/PEPGMP-deploy
docker compose -f docker-compose.prod.yml --env-file .env.production up -d

# 5. æ£€æŸ¥å¯åŠ¨çŠ¶æ€
docker compose -f docker-compose.prod.yml --env-file .env.production ps
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: å®¹å™¨æ— æ³•åˆ é™¤ï¼ˆæ­£åœ¨è¿è¡Œï¼‰

**è§£å†³**ï¼š
```bash
# å¼ºåˆ¶åœæ­¢å¹¶åˆ é™¤
docker rm -f pepgmp-postgres-prod
```

### é—®é¢˜ 2: æœ‰å¤šä¸ªéƒ¨ç½²ç›®å½•

**è§£å†³**ï¼š
```bash
# æ‰¾åˆ°æ‰€æœ‰éƒ¨ç½²ç›®å½•
find ~/projects -name "docker-compose.prod.yml"

# åœ¨æ¯ä¸ªç›®å½•ä¸­è¿è¡Œ down
cd ~/projects/Pyt
docker compose -f docker-compose.prod.yml down

cd ~/projects/PEPGMP-deploy
docker compose -f docker-compose.prod.yml down
```

### é—®é¢˜ 3: æ¸…ç†åä»æœ‰å†²çª

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥æ˜¯å¦æœ‰æ®‹ç•™çš„ç½‘ç»œæˆ–å·
docker network ls | grep pepgmp
docker volume ls | grep pepgmp

# æ¸…ç†ç½‘ç»œï¼ˆå¦‚éœ€è¦ï¼‰
docker network rm $(docker network ls -q --filter "name=pepgmp") 2>/dev/null || true

# æ¸…ç†å·ï¼ˆæ³¨æ„ï¼šä¼šåˆ é™¤æ•°æ®ï¼ï¼‰
# docker volume rm $(docker volume ls -q --filter "name=pepgmp") 2>/dev/null || true
```

---

## ğŸ“ é¢„é˜²æªæ–½

### 1. ä½¿ç”¨ä¸åŒçš„é¡¹ç›®åç§°

å¦‚æœéœ€è¦åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œå¤šä¸ªéƒ¨ç½²ï¼Œå¯ä»¥ä¿®æ”¹å®¹å™¨åç§°ï¼š

```yaml
# docker-compose.prod.yml
services:
  database:
    container_name: pepgmp-postgres-prod-${DEPLOY_ENV:-default}
  # ...
```

### 2. éƒ¨ç½²å‰å…ˆæ¸…ç†

```bash
# åœ¨å¯åŠ¨å‰å…ˆæ¸…ç†
docker compose -f docker-compose.prod.yml down 2>/dev/null || true
docker compose -f docker-compose.prod.yml --env-file .env.production up -d
```

### 3. ä½¿ç”¨ç‹¬ç«‹çš„éƒ¨ç½²ç›®å½•

```bash
# æ¯ä¸ªéƒ¨ç½²ä½¿ç”¨ç‹¬ç«‹çš„ç›®å½•
~/projects/PEPGMP-deploy-1/
~/projects/PEPGMP-deploy-2/
```

---

## âœ… éªŒè¯æ¸…ç†ç»“æœ

```bash
# æ£€æŸ¥å®¹å™¨
docker ps -a | grep pepgmp
# åº”è¯¥æ²¡æœ‰è¾“å‡º

# æ£€æŸ¥ç½‘ç»œ
docker network ls | grep pepgmp
# åº”è¯¥æ²¡æœ‰è¾“å‡ºï¼ˆæˆ–åªæœ‰æ–°åˆ›å»ºçš„ï¼‰

# æ£€æŸ¥å·ï¼ˆæ³¨æ„ï¼šå·é€šå¸¸ä¿ç•™æ•°æ®ï¼‰
docker volume ls | grep pepgmp
```

---

**æœ€åæ›´æ–°**: 2025-12-04
